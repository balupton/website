jQuery.fn.between=function(a,b){if(this[0].nodeType!==3){if(b>this.children().size())b=this.children().size();b<=0?this.prepend(a):this.children().eq(b-1).after(a)}else if(b<=0)this.before(a);else{if(!(b>=this[0].length)){var c=this[0].data;this[0].data=c.substring(0,b);this.after(c.substring(b,c.length))}this.after(a)}};
jQuery.fn.removeCss=function(a){return this.each(function(){jQuery(this).attr("style");var b=jQuery.grep(jQuery(this).attr("style").split(";"),function(c){var d=c.split(":");if(d[0])if(d[0].toUpperCase().trim().indexOf(a.toUpperCase())==-1)return c}).join(";").trim();jQuery(this).removeAttr("style");b.trim()&&jQuery(this).attr("style",b);return jQuery(this)})};
jQuery.fn.contentEditable=function(a){var b="contenteditable";if(jQuery.browser.msie&&parseInt(jQuery.browser.version)==7)b="contentEditable";if(a==undefined)return jQuery(this).attr(b);else if(a==="")jQuery(this).removeAttr(b);else{a=a&&a!=="false"?"true":"false";jQuery(this).attr(b,a)}};if(typeof GENTICS=="undefined"||!GENTICS)var GENTICS={};if(typeof GENTICS.Utils=="undefined"||!GENTICS)GENTICS.Utils={};GENTICS.Utils.applyProperties=function(a,b){var c;for(c in b)if(b.hasOwnProperty(c))a[c]=b[c]};
GENTICS.Utils.uniqeString4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};GENTICS.Utils.guid=function(){var a=GENTICS.Utils.uniqeString4;return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};if(typeof GENTICS=="undefined"||!GENTICS)GENTICS={};if(typeof GENTICS.Utils=="undefined"||!GENTICS)GENTICS.Utils={};
GENTICS.Utils.RangeObject=function(a){this.startParents=[];this.endParents=[];this.rangeTree=[];if(typeof a==="object"){if(a.startContainer!==undefined)this.startContainer=a.startContainer;if(a.startOffset!==undefined)this.startOffset=a.startOffset;if(a.endContainer!==undefined)this.endContainer=a.endContainer;if(a.endOffset!==undefined)this.endOffset=a.endOffset}else a===true&&this.initializeFromUserSelection()};
GENTICS.Utils.RangeObject.prototype.log=function(a,b){if(GENTICS&&GENTICS.Aloha&&GENTICS.Aloha.Log){GENTICS.Aloha.Log.debug(this,a);return false}if(console){console.log(a);b&&console.log(b)}};GENTICS.Utils.RangeObject.prototype.isCollapsed=function(){return!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset};
GENTICS.Utils.RangeObject.prototype.getCommonAncestorContainer=function(){if(this.commonAncestorContainer)return this.commonAncestorContainer;this.updateCommonAncestorContainer();return this.commonAncestorContainer};
GENTICS.Utils.RangeObject.prototype.getContainerParents=function(a,b){var c=b?this.endContainer:this.startContainer,d=b?this.endParents:this.startParents;if(!c)return false;if(typeof a=="undefined")a=jQuery("body");if(!d[a.get(0)]){var e;if(c.nodeType==3)e=jQuery(c).parents();else{e=jQuery(c).parents();for(var g=e.length;g>0;--g)e[g]=e[g-1];e[0]=c}c=e.index(a);if(c>=0)e=e.slice(0,c);d[a.get(0)]=e}return d[a.get(0)]};
GENTICS.Utils.RangeObject.prototype.getStartContainerParents=function(a){return this.getContainerParents(a,false)};GENTICS.Utils.RangeObject.prototype.getEndContainerParents=function(a){return this.getContainerParents(a,true)};
GENTICS.Utils.RangeObject.prototype.updateCommonAncestorContainer=function(a){var b=this.getStartContainerParents(),c=this.getEndContainerParents();if(a)this.commonAncestorContainer=a;else{if(!(b.length>0&&c.length>0)){GENTICS.Utils.RangeObject.prototype.log("could not find commonAncestorContainer");return false}for(var d=0;d<b.length;d++)if(c.index(b[d])!=-1){this.commonAncestorContainer=b[d];break}}GENTICS.Utils.RangeObject.prototype.log(a?"commonAncestorContainer was set successfully":"commonAncestorContainer was calculated successfully");
return true};
GENTICS.Utils.RangeObject.prototype.getCollapsedIERange=function(a,b){var c=document.body.createTextRange(),d=this.searchElementToLeft(a,b);if(d.element){var e=document.body.createTextRange();e.moveToElementText(d.element);c.setEndPoint("StartToEnd",e);if(d.characters!=0)c.moveStart("character",d.characters);else{c.moveStart("character",1);c.moveStart("character",-1)}}else{this.searchElementToRight(a,b);var g=a.nodeType==3?a.parentNode:a;e=document.body.createTextRange();e.moveToElementText(g);c.setEndPoint("StartToStart",
e);d.characters!=0&&c.moveStart("character",d.characters)}c.collapse();return c};
GENTICS.Utils.RangeObject.prototype.select=document.createRange===undefined?function(){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"Set selection to current range (IE version)");if(this.startContainer.nodeType==3&&GENTICS.Utils.Dom.isBlockLevelElement(this.startContainer.nextSibling)){jQuery(this.startContainer).after("<br/>");this.endContainer===this.startContainer.parentNode&&GENTICS.Utils.Dom.getIndexInParent(this.startContainer)<this.endOffset&&this.endOffset++}var a=document.body.createTextRange(),
b=this.getCollapsedIERange(this.startContainer,this.startOffset);a.setEndPoint("StartToStart",b);if(this.isCollapsed())a.collapse();else{b=this.getCollapsedIERange(this.endContainer,this.endOffset);a.setEndPoint("EndToStart",b)}a.select()}:function(){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"Set selection to current range (non IE version)");var a=document.createRange();a.setStart(this.startContainer,this.startOffset);a.setEnd(this.endContainer,this.endOffset);window.getSelection().removeAllRanges();
window.getSelection().addRange(a)};GENTICS.Utils.RangeObject.prototype.searchElementToLeft=function(a,b){var c=undefined,d=0;if(a.nodeType==3){d=b;c=a.previousSibling}else if(b>0)c=a.childNodes[b-1];for(;c&&c.nodeType==3;){d+=c.data.length;c=c.previousSibling}return{element:c,characters:d}};
GENTICS.Utils.RangeObject.prototype.searchElementToRight=function(a,b){var c=undefined,d=0;if(a.nodeType==3){d=a.data.length-b;c=a.nextSibling}else if(b<a.childNodes.length)c=a.childNodes[b];for(;c&&c.nodeType==3;){d+=c.data.length;c=c.nextSibling}return{element:c,characters:d}};GENTICS.Utils.RangeObject.prototype.update=function(a){GENTICS.Utils.RangeObject.prototype.log("==========");GENTICS.Utils.RangeObject.prototype.log("now updating rangeObject");this.initializeFromUserSelection(a);this.updateCommonAncestorContainer()};
GENTICS.Utils.RangeObject.prototype.initializeFromUserSelection=function(){var a=window.getSelection();if(!a)return false;a=a.getRangeAt(0);if(!a)return false;this.startContainer=a.startContainer;this.endContainer=a.endContainer;this.startOffset=a.startOffset;this.endOffset=a.endOffset;this.correctRange()};
GENTICS.Utils.RangeObject.prototype.correctRange=function(){this.clearCaches();if(this.isCollapsed()){if(this.startContainer.nodeType==1){if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType==3){this.startContainer=this.startContainer.childNodes[this.startOffset-1];this.startOffset=this.startContainer.data.length;this.endContainer=this.startContainer;this.endOffset=this.startOffset;return}if(this.startOffset>0&&this.startContainer.childNodes[this.startOffset-1].nodeType==
1){var a=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,true);if(a){this.startContainer=this.endContainer=a;this.startOffset=this.endOffset=a.data.length;return}if(a=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer,this.startOffset,false)){this.startContainer=this.endContainer=a;this.startOffset=this.endOffset=0;return}}if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType==3){this.startContainer=
this.startContainer.childNodes[this.startOffset];this.startOffset=0;this.endContainer=this.startContainer;this.endOffset=0;return}}if(this.startContainer.nodeType==3&&this.startOffset==0)if(a=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer),true)){this.startContainer=this.endContainer=a;this.startOffset=this.endOffset=a.data.length}}else{if(this.startContainer.nodeType==1)if(this.startOffset<this.startContainer.childNodes.length&&
this.startContainer.childNodes[this.startOffset].nodeType==3){this.startContainer=this.startContainer.childNodes[this.startOffset];this.startOffset=0}else if(this.startOffset<this.startContainer.childNodes.length&&this.startContainer.childNodes[this.startOffset].nodeType==1){a=false;for(var b=this.startContainer.childNodes[this.startOffset];a===false&&b.childNodes&&b.childNodes.length>0;){b=b.childNodes[0];if(b.nodeType==3)a=b}if(a!==false){this.startContainer=a;this.startOffset=0}}if(this.startContainer.nodeType==
3&&this.startOffset==this.startContainer.data.length)if(a=GENTICS.Utils.Dom.searchAdjacentTextNode(this.startContainer.parentNode,GENTICS.Utils.Dom.getIndexInParent(this.startContainer)+1,false)){this.startContainer=a;this.startOffset=0}if(this.endContainer.nodeType==3&&this.endOffset==0)if(this.endContainer.previousSibling&&this.endContainer.previousSibling.nodeType==3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else if(this.endContainer.previousSibling&&
this.endContainer.previousSibling.nodeType==1&&this.endContainer.parentNode){a=this.endContainer.parentNode;for(b=0;b<a.childNodes.length;++b)if(a.childNodes[b]==this.endContainer){this.endOffset=b;break}this.endContainer=a}if(this.endContainer.nodeType==1&&this.endOffset==0)if(this.endContainer.previousSibling)if(this.endContainer.previousSibling.nodeType==3){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.data.length}else if(this.endContainer.previousSibling.nodeType==
1&&this.endContainer.previousSibling.childNodes&&this.endContainer.previousSibling.childNodes.length>0){this.endContainer=this.endContainer.previousSibling;this.endOffset=this.endContainer.childNodes.length}if(this.endContainer.nodeType==1)if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-1].nodeType==3){this.endContainer=this.endContainer.childNodes[this.endOffset-1];this.endOffset=this.endContainer.data.length}else if(this.endOffset>0&&this.endContainer.childNodes[this.endOffset-
1].nodeType==1){a=false;for(b=this.endContainer.childNodes[this.endOffset-1];a===false&&b.childNodes&&b.childNodes.length>0;){b=b.childNodes[b.childNodes.length-1];if(b.nodeType==3)a=b}if(a!==false){this.endContainer=a;this.endOffset=this.endContainer.data.length}}}};GENTICS.Utils.RangeObject.prototype.clearCaches=function(){this.rangeTree=[];this.startParents=[];this.endParents=[];this.commonAncestorContainer=undefined};
GENTICS.Utils.RangeObject.prototype.getRangeTree=function(a){if(typeof a=="undefined")a=this.getCommonAncestorContainer();if(this.rangeTree[a])return this.rangeTree[a];this.inselection=false;this.rangeTree[a]=this.recursiveGetRangeTree(a);return this.rangeTree[a]};
GENTICS.Utils.RangeObject.prototype.recursiveGetRangeTree=function(a){var b=0,c=this,d=[];jQuery(a).contents().each(function(e){var g="none",f=false,h=false,j=false;if(c.isCollapsed()&&a===c.startContainer&&c.startOffset==e){d[b]=new GENTICS.Utils.RangeTree;d[b].type="collapsed";d[b].domobj=undefined;c.inselection=false;j=true;b++}if(!c.inselection&&!j)switch(this.nodeType){case 3:if(this===c.startContainer){c.inselection=true;g=c.startOffset>0?"partial":"full";f=c.startOffset;h=this.length}break;
case 1:if(this===c.startContainer&&c.startOffset==0){c.inselection=true;g="full"}if(a===c.startContainer&&c.startOffset==e){c.inselection=true;g="full"}break}if(c.inselection&&!j){if(g=="none")g="full";switch(this.nodeType){case 3:if(this===c.endContainer){c.inselection=false;if(c.endOffset<this.length)g="partial";if(f===false)f=0;h=c.endOffset}break;case 1:if(this===c.endContainer&&c.endOffset==0)c.inselection=false;break}if(a===c.endContainer&&c.endOffset<=e){c.inselection=false;g="none"}}d[b]=
new GENTICS.Utils.RangeTree;d[b].domobj=this;d[b].type=g;if(g=="partial"){d[b].startOffset=f;d[b].endOffset=h}d[b].children=c.recursiveGetRangeTree(this);if(d[b].children.length>0){f=g=e=false;for(h=0;h<d[b].children.length;++h)switch(d[b].children[h].type){case "none":e=true;break;case "full":f=true;break;case "partial":g=true;break}if(g||f&&e)d[b].type="partial";else if(f&&!g&&!e)d[b].type="full"}b++});if(this.isCollapsed()&&a===this.startContainer&&this.startOffset==a.childNodes.length){d[b]=new GENTICS.Utils.RangeTree;
d[b].type="collapsed";d[b].domobj=undefined}return d};GENTICS.Utils.RangeObject.prototype.findMarkup=function(a,b,c){b=this.getContainerParents(b,c);var d=false;jQuery.each(b,function(e,g){if(a.apply(g)){d=g;return false}});return d};GENTICS.Utils.RangeTree=function(){this.domobj={};this.children=[]};if(typeof GENTICS=="undefined"||!GENTICS)GENTICS={};if(typeof GENTICS.Utils=="undefined"||!GENTICS)GENTICS.Utils={};GENTICS.Utils.Position={};GENTICS.Utils.Position.w=jQuery(window);
GENTICS.Utils.Position.Scroll={top:0,left:0,isScrolling:false};GENTICS.Utils.Position.ScrollCorrection={top:0,left:0};GENTICS.Utils.Position.Mouse={x:0,y:0,oldX:0,oldY:0,isMoving:false,triggeredMouseStop:true};GENTICS.Utils.Position.mouseStopCallbacks=[];GENTICS.Utils.Position.mouseMoveCallbacks=[];
GENTICS.Utils.Position.update=function(){var a=this.w.scrollTop(),b=this.w.scrollLeft();if(this.Scroll.isScrolling){if(this.Scroll.top==a&&this.Scroll.left==b)this.Scroll.isScrolling=false}else if(this.Scroll.top!=a||this.Scroll.left!=b)this.Scroll.isScrolling=true;this.Scroll.top=a;this.Scroll.left=b;if(this.Mouse.x==this.Mouse.oldX&&this.Mouse.y==this.Mouse.oldY){this.Mouse.isMoving=false;if(!this.Mouse.triggeredMouseStop){this.Mouse.triggeredMouseStop=true;for(a=0;a<this.mouseStopCallbacks.length;a++)this.mouseStopCallbacks[a].call()}}else{this.Mouse.isMoving=
true;this.Mouse.triggeredMouseStop=false;for(a=0;a<this.mouseMoveCallbacks.length;a++)this.mouseMoveCallbacks[a].call()}this.Mouse.oldX=this.Mouse.x;this.Mouse.oldY=this.Mouse.y};GENTICS.Utils.Position.addMouseStopCallback=function(a){this.mouseStopCallbacks.push(a);return this.mouseStopCallbacks.length-1};GENTICS.Utils.Position.addMouseMoveCallback=function(a){this.mouseMoveCallbacks.push(a);return this.mouseMoveCallbacks.length-1};setInterval("GENTICS.Utils.Position.update()",500);
jQuery("html").mousemove(function(a){GENTICS.Utils.Position.Mouse.x=a.pageX;GENTICS.Utils.Position.Mouse.y=a.pageY});if(typeof GENTICS!=="object")GENTICS={};if(typeof GENTICS.Utils!=="object")GENTICS.Utils={};if(typeof GENTICS.Utils.Dom!=="function")GENTICS.Utils.Dom=function(){};GENTICS.Utils.Dom.prototype.mergeableTags=["a","b","code","del","em","i","ins","strong","sub","sup","#text"];
GENTICS.Utils.Dom.prototype.nonWordBoundaryTags=["a","b","code","del","em","i","ins","span","strong","sub","sup","#text"];GENTICS.Utils.Dom.prototype.nonEmptyTags=["br"];
GENTICS.Utils.Dom.prototype.tags={flow:["a","abbr","address","area","article","aside","audio","b","bdo","blockquote","br","button","canvas","cite","code","command","datalist","del","details","dfn","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","menu","meter","nav","noscript","object","ol","output","p","pre","progress","q","ruby","samp","script","section","select",
"small","span","strong","style","sub","sup","svg","table","textarea","time","ul","var","video","wbr","#text"],phrasing:["a","abbr","area","audio","b","bdo","br","button","canvas","cite","code","command","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","samp","script","select","small","span","strong","sub","sup","svg","textarea","time","var","video","wbr","#text"]};
GENTICS.Utils.Dom.prototype.children={a:"phrasing",abbr:"phrasing",address:"flow",area:"empty",article:"flow",aside:"flow",audio:"source",b:"phrasing",base:"empty",bdo:"phrasing",blockquote:"flow",body:"flow",br:"empty",button:"phrasing",canvas:"phrasing",caption:"flow",cite:"phrasing",code:"phrasing",col:"empty",colgroup:"col",command:"empty",datalist:["phrasing","option"],dd:"flow",del:"phrasing",div:"flow",details:["summary","flow"],dfn:"flow",div:"flow",dl:["dt","dd"],dt:"phrasing",em:"phrasing",
embed:"empty",fieldset:["legend","flow"],figcaption:"flow",figure:["figcaption","flow"],footer:"flow",form:"flow",h1:"phrasing",h2:"phrasing",h3:"phrasing",h4:"phrasing",h5:"phrasing",h6:"phrasing",header:"flow",hgroup:["h1","h2","h3","h4","h5","h6"],hr:"empty",i:"phrasing",iframe:"#text",img:"empty",input:"empty",ins:"phrasing",kbd:"phrasing",keygen:"empty",label:"phrasing",legend:"phrasing",li:"flow",link:"empty",map:"area",mark:"phrasing",menu:["li","flow"],meta:"empty",meter:"phrasing",nav:"flow",
noscript:"phrasing",object:"param",ol:"li",optgroup:"option",option:"#text",output:"phrasing",p:"phrasing",param:"empty",pre:"phrasing",progress:"phrasing",q:"phrasing",rp:"phrasing",rt:"phrasing",ruby:["phrasing","rt","rp"],s:"phrasing",samp:"pharsing",script:"#script",section:"flow",select:["option","optgroup"],small:"phrasing",source:"empty",span:"phrasing",strong:"phrasing",style:"phrasing",sub:"phrasing",summary:"phrasing",sup:"phrasing",table:["caption","colgroup","thead","tbody","tfoot","tr"],
tbody:"tr",td:"flow",textarea:"#text",tfoot:"tr",th:"phrasing",thead:"tr",time:"phrasing",title:"#text",tr:["th","td"],track:"empty",ul:"li","var":"phrasing",video:"source",wbr:"empty"};GENTICS.Utils.Dom.prototype.blockLevelElements=["p","h1","h2","h3","h4","h5","h6","blockquote","div","pre"];GENTICS.Utils.Dom.prototype.listElements=["li","ol","ul"];
GENTICS.Utils.Dom.prototype.split=function(a,b,c){var d=jQuery(a.startContainer),e=a.startOffset;if(c){d=jQuery(a.endContainer);e=a.endOffset}if(b.length<1)b=jQuery(document.body);c=!a.isCollapsed()&&!c;var g,f=d.parents().get();f.unshift(d.get(0));jQuery.each(f,function(p,q){if(b.filter(function(){return this==q}).length){if(p>0)g=f.slice(0,p);return false}});if(!g)return true;g=g.reverse();var h,j;for(d=0;d<g.length;d++){var k=g[d];if(d===g.length-1){var m;if(k.nodeType===3){m=document.createTextNode(k.data.substring(e,
k.data.length));k.data=k.data.substring(0,e)}else{var n=jQuery(k).clone(false).empty();m=jQuery(k).contents();m=n.append(m.slice(e,m.length)).get(0)}if(c&&a.endContainer===k){a.endContainer=m;a.endOffset-=e;a.clearCaches()}j?j.prepend(m):jQuery(k).after(m)}else{n=jQuery(k).clone(false).empty();if(h)j.prepend(n);else h=n;j=n;for(var o;o=g[d+1].nextSibling;)j.append(o);if(c&&a.endContainer===k){a.endContainer=n.get(0);k=g[d+1];for(n=0;k=k.previousSibling;)n++;a.endOffset-=n;a.clearCaches()}}}jQuery(g[0]).after(h);
return jQuery([g[0],h?h.get(0):m])};GENTICS.Utils.Dom.prototype.allowsNesting=function(a,b){if(!a||!a.nodeName||!b||!b.nodeName)return false;var c=a.nodeName.toLowerCase(),d=b.nodeName.toLowerCase();if(!this.children[c])return false;if(this.children[c]==d)return true;if(jQuery.isArray(this.children[c])&&jQuery.inArray(d,this.children[c])>=0)return true;if(jQuery.isArray(this.tags[this.children[c]])&&jQuery.inArray(d,this.tags[this.children[c]])>=0)return true;return false};
GENTICS.Utils.Dom.prototype.addMarkup=function(a,b,c){a.startContainer.nodeType==3&&a.startOffset>0&&a.startOffset<a.startContainer.data.length&&this.split(a,jQuery(a.startContainer).parent(),false);a.endContainer.nodeType==3&&a.endOffset>0&&a.endOffset<a.endContainer.data.length&&this.split(a,jQuery(a.endContainer).parent(),true);this.recursiveAddMarkup(a.getRangeTree(),b,a,c);this.doCleanup({merge:true,removeempty:true},a)};
GENTICS.Utils.Dom.prototype.recursiveAddMarkup=function(a,b,c,d){for(c=0;c<a.length;++c)if(a[c].type=="full"&&this.allowsNesting(b.get(0),a[c].domobj)){if((d||a[c].domobj.nodeName!=b.get(0).nodeName)&&(a[c].domobj.nodeType!=3||jQuery.trim(a[c].domobj.data).length!=0)){jQuery(a[c].domobj).wrap(b);if(!d&&a[c].domobj.nodeType!=3){var e=new GENTICS.Utils.RangeObject;e.startContainer=e.endContainer=a[c].domobj.parentNode;e.startOffset=0;e.endOffset=e.endContainer.childNodes.length;this.removeMarkup(e,
b,jQuery(a[c].domobj.parentNode))}}}else if(d||a[c].domobj.nodeName!=b.get(0).nodeName)a[c].children&&a[c].children.length>0&&this.recursiveAddMarkup(a[c].children,b)};GENTICS.Utils.Dom.prototype.findHighestElement=function(a,b,c){var d=a;b=b.toLowerCase();a=c?function(){return c.filter(function(){return d==this}).length}:function(){return false};for(var e=undefined;!a()&&d;){if(d.nodeName.toLowerCase()==b)e=d;d=d.parentNode}return e};
GENTICS.Utils.Dom.prototype.removeMarkup=function(a,b,c){var d=b.get(0).nodeName,e=this.findHighestElement(a.startContainer,d,c),g=this.findHighestElement(a.endContainer,d,c),f=false;if(e){this.split(a,jQuery(e).parent(),false);f=true}if(g){this.split(a,jQuery(g).parent(),true);f=true}f&&a.correctRange();c=(c=this.findHighestElement(a.getCommonAncestorContainer(),d,c))?c.parentNode:undefined;this.recursiveRemoveMarkup(a.getRangeTree(c),b);this.doCleanup({merge:true,removeempty:true},a,c)};
GENTICS.Utils.Dom.prototype.recursiveRemoveMarkup=function(a,b){for(var c=0;c<a.length;++c){if(a[c].type=="full"&&a[c].domobj.nodeName==b.get(0).nodeName){var d=jQuery(a[c].domobj).contents();d.length>0?d.first().unwrap():jQuery(a[c].domobj).remove()}a[c].children&&this.recursiveRemoveMarkup(a[c].children,b)}};
GENTICS.Utils.Dom.prototype.doCleanup=function(a,b,c){var d=this;if(typeof a=="undefined")a={merge:true,removeempty:true};if(typeof c=="undefined")if(b)c=b.getCommonAncestorContainer();var e=false,g=false,f=jQuery(c);f.contents().each(function(h){switch(this.nodeType){case 1:if(e&&e.nodeName==this.nodeName){if(b.startContainer===f&&b.startOffset>h){b.startOffset-=1;g=true}if(b.endContainer===f&&b.endOffset>h){b.endOffset-=1;g=true}jQuery(e).append(jQuery(this).contents());g|=d.doCleanup(a,b,e);jQuery(this).remove()}else{g|=
d.doCleanup(a,b,this);h=false;if(a.removeempty){if(GENTICS.Utils.Dom.isBlockLevelElement(this)&&this.childNodes.length==0){jQuery(this).remove();h=true}if(jQuery.inArray(this.nodeName.toLowerCase(),d.mergeableTags)>=0&&jQuery(this).text().length==0&&this.childNodes.length==0){jQuery(this).remove();h=true}}h||(e=jQuery.inArray(this.nodeName.toLowerCase(),d.mergeableTags)>=0?this:false)}break;case 3:if(e&&e.nodeType==3&&a.merge){if(b.startContainer===this){b.startContainer=e;b.startOffset+=e.length;
g=true}if(b.endContainer===this){b.endContainer=e;b.endOffset+=e.length;g=true}if(b.startContainer===f&&b.startOffset>h){b.startOffset-=1;g=true}if(b.endContainer===f&&b.endOffset>h){b.endOffset-=1;g=true}e.data+=this.data;jQuery(this).remove()}else e=this;break}});if(a.removeempty&&GENTICS.Utils.Dom.isBlockLevelElement(c)&&(!c.childNodes||c.childNodes.length==0)){if(b.startContainer==c){b.startContainer=c.parentNode;b.startOffset=GENTICS.Utils.Dom.getIndexInParent(c)}if(b.endContainer==c){b.endContainer=
c.parentNode;b.endOffset=GENTICS.Utils.Dom.getIndexInParent(c)}f.remove();g=true}g&&b.clearCaches();return g};GENTICS.Utils.Dom.prototype.getIndexInParent=function(a){if(!a)return false;var b=0;for(a=a.previousSibling;a;){b++;a=a.previousSibling}return b};GENTICS.Utils.Dom.prototype.isBlockLevelElement=function(a){if(!a)return false;return a.nodeType==1&&jQuery.inArray(a.nodeName.toLowerCase(),this.blockLevelElements)>=0?true:false};
GENTICS.Utils.Dom.prototype.isLineBreakElement=function(a){if(!a)return false;return a.nodeType==1&&a.nodeName.toLowerCase()=="br"};GENTICS.Utils.Dom.prototype.isListElement=function(a){if(!a)return false;return a.nodeType==1&&jQuery.inArray(a.nodeName.toLowerCase(),this.listElements)>=0};GENTICS.Utils.Dom.prototype.isSplitObject=function(a){if(a.nodeType===1)switch(a.nodeName.toLowerCase()){case "p":case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":case "li":return true}return false};
GENTICS.Utils.Dom.prototype.searchAdjacentTextNode=function(a,b,c,d){if(!a||a.nodeType!=1||b<0||b>a.childNodes.length)return false;if(typeof d=="undefined")d={blocklevel:true,list:true,linebreak:true};if(d.blocklevel=="undefined")stopal.blocklevel=true;if(d.list=="undefined")stopal.list=true;if(d.linebreak=="undefined")stopal.linebreak=true;if(typeof c=="undefined")c=true;var e=undefined,g=a;if(c&&b>0)e=a.childNodes[b-1];if(!c&&b<a.childNodes.length)e=a.childNodes[b];for(;typeof g!="undefined";)if(e)if(e.nodeType==
3&&jQuery.trim(e.data).length>0)return e;else if(d.blocklevel&&this.isBlockLevelElement(e))return false;else if(d.linebreak&&this.isLineBreakElement(e))return false;else if(d.list&&this.isListElement(e))return false;else if(e.nodeType==3)e=c?e.previousSibling:e.nextSibling;else{g=e;e=c?e.lastChild:e.firstChild}else if(d.blocklevel&&this.isBlockLevelElement(g))return false;else if(d.list&&this.isListElement(g))return false;else{e=c?g.previousSibling:g.nextSibling;g=g.parentNode}};
GENTICS.Utils.Dom.prototype.insertIntoDOM=function(a,b,c,d){var e=b.getContainerParents(c,d),g=this,f;c||(c=jQuery(document.body));if(e.length==0)f=c.get(0);else jQuery.each(e,function(h,j){if(g.allowsNesting(j,a.get(0))){f=j;return false}});if(typeof f=="undefined"&&c.length>0)f=c.get(0);if(typeof f!="undefined"){c=this.split(b,jQuery(f),d);if(c===true){c=b.startContainer;e=b.startOffset;if(d){c=b.endContainer;e=b.endOffset}if(e==0){b=jQuery(c).contents();b.length>0?b.eq(0).before(a):jQuery(c).append(a)}else jQuery(c).contents().eq(e-
1).after(a);return true}else if(c){c.eq(0).after(a);return true}else return false}else return false};
GENTICS.Utils.Dom.prototype.removeFromDOM=function(a,b,c){if(c){c=this.getIndexInParent(a);var d=jQuery(a).contents().length,e=a.parentNode;if(b.startContainer==e&&b.startOffset>c)b.startOffset+=d-1;else if(b.startContainer==a){b.startContainer=e;b.startOffset=c+b.startOffset}if(b.endContainer==e&&b.endOffset>c)b.endOffset+=d-1;else if(b.endContainer==a){b.endContainer=e;b.endOffset=c+b.endOffset}jQuery(a).contents().unwrap();this.doCleanup({merge:true},b,e)}};
GENTICS.Utils.Dom.prototype.extendToWord=function(a,b){var c=this.searchWordBoundary(a.startContainer,a.startOffset,true),d=this.searchWordBoundary(a.endContainer,a.endOffset,false);if(!b){if(a.startContainer==c.container&&a.startOffset==c.offset)return;if(a.endContainer==d.container&&a.endOffset==d.offset)return}a.startContainer=c.container;a.startOffset=c.offset;a.endContainer=d.container;a.endOffset=d.offset;a.correctRange();a.clearCaches()};
GENTICS.Utils.Dom.prototype.isWordBoundaryElement=function(a){if(!a||!a.nodeName)return false;return jQuery.inArray(a.nodeName.toLowerCase(),this.nonWordBoundaryTags)==-1};
GENTICS.Utils.Dom.prototype.searchWordBoundary=function(a,b,c){if(typeof c=="undefined")c=true;for(var d=false;!d;)if(a.nodeType==3)if(c){for(var e=g=a.data.substring(0,b).search(/\W/);e!=-1;){g=e;e=a.data.substring(g+1,b).search(/\W/);if(e!=-1)e=e+g+1}if(g!=-1){b=g+1;d=true}else{b=this.getIndexInParent(a);a=a.parentNode}}else{var g=a.data.substring(b).search(/\W/);if(g!=-1){b+=g;d=true}else{b=this.getIndexInParent(a)+1;a=a.parentNode}}else if(a.nodeType==1)if(c)if(b>0)if(this.isWordBoundaryElement(a.childNodes[b-
1]))d=true;else{a=a.childNodes[b-1];b=a.nodeType==3?a.data.length:a.childNodes.length}else if(this.isWordBoundaryElement(a))d=true;else{b=this.getIndexInParent(a);a=a.parentNode}else if(b<a.childNodes.length)if(this.isWordBoundaryElement(a.childNodes[b]))d=true;else{a=a.childNodes[b];b=0}else if(this.isWordBoundaryElement(a))d=true;else{b=this.getIndexInParent(a)+1;a=a.parentNode}if(a.nodeType!=3)if(d=this.searchAdjacentTextNode(a,b,!c)){a=d;b=c?0:a.data.length}return{container:a,offset:b}};
GENTICS.Utils.Dom.prototype.isEmpty=function(a){if(!a)return true;if(jQuery.inArray(a.nodeName.toLowerCase(),this.nonEmptyTags)!=-1)return false;if(a.nodeType==3)return a.data.search(/\S/)==-1;for(var b=0;b<a.childNodes.length;++b)if(!this.isEmpty(a.childNodes[b]))return false;return true};GENTICS.Utils.Dom.prototype.setCursorAfter=function(a){var b=new GENTICS.Utils.RangeObject;b.startContainer=b.endContainer=a.parentNode;b.startOffset=b.endOffset=this.getIndexInParent(a);b.select()};
GENTICS.Utils.Dom.prototype.setCursorInto=function(a){var b=new GENTICS.Utils.RangeObject;b.startContainer=b.endContainer=a;b.startOffset=b.endOffset=0;b.select()};GENTICS.Utils.Dom=new GENTICS.Utils.Dom;if(!Array.indexOf)Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1};
Ext.data.AlohaProxy=function(){var a={};a[Ext.data.Api.actions.read]=true;Ext.data.AlohaProxy.superclass.constructor.call(this,{api:a});this.params={queryString:null,objectTypeFilter:null,filter:null,inFolderId:null,orderBy:null,maxItems:null,skipCount:null,renditionFilter:null,repositoryId:null}};
Ext.extend(Ext.data.AlohaProxy,Ext.data.DataProxy,{doRequest:function(a,b,c,d,e,g,f){b=this.params;jQuery.extend(b,c);try{GENTICS.Aloha.RepositoryManager.query(b,function(j){j=d.readRecords(j);e.call(g,j,f,true)})}catch(h){this.fireEvent("loadexception",this,null,f,h);this.fireEvent("exception",this,"response",a,f,null,h);return false}},setObjectTypeFilter:function(a){this.params.objectTypeFilter=a},getObjectTypeFilter:function(){return this.params.objectTypeFilter},setParams:function(a){jQuery.extend(this.params,
a)}});Ext.data.AlohaObjectReader=function(a){a={};Ext.applyIf(a,{idProperty:"id",root:"items",totalProperty:"results",fields:["id","url","name","type","weight","repositoryId"]});Ext.data.JsonReader.superclass.constructor.call(this,a,a.fields)};Ext.extend(Ext.data.AlohaObjectReader,Ext.data.JsonReader,{});Ext.tree.AlohaTreeLoader=function(a){Ext.apply(this,a);Ext.tree.AlohaTreeLoader.superclass.constructor.call(this)};
Ext.extend(Ext.tree.AlohaTreeLoader,Ext.tree.TreeLoader,{paramOrder:["node","id"],nodeParameter:"id",directFn:function(a,b,c){GENTICS.Aloha.RepositoryManager.getChildren({inFolderId:a.id,objectTypeFilter:this.objectTypeFilter,repositoryId:a.repositoryId},function(d){var e={};e={status:true,scope:this,argument:{callback:c,node:a}};typeof c=="function"&&c(d,e)})},createNode:function(a){if(a.name)a.text=a.name;if(a.hasMoreItems)a.leaf=!a.hasMoreItems;if(a.objectType)a.cls=a.objectType;return Ext.tree.TreeLoader.prototype.createNode.call(this,
a)},objectTypeFilter:null,setObjectTypeFilter:function(a){this.objectTypeFilter=a},getObjectTypeFilter:function(){return this.objectTypeFilter}});if(typeof GENTICS=="undefined"||!GENTICS)GENTICS={};GENTICS.Aloha=function(){};GENTICS.Aloha.setAutobase=function(){var a=jQuery("script");a=a[a.length-1].src.split("?")[0];a=a.split("/");var b=1;if("core"===a[a.length-2])b=2;GENTICS.Aloha.prototype.autobase=a.slice(0,b*-1).join("/")+"/"};GENTICS.Aloha.setAutobase();GENTICS.Aloha.prototype.version="nightly";
GENTICS.Aloha.prototype.editables=[];GENTICS.Aloha.prototype.activeEditable=null;GENTICS.Aloha.prototype.ready=false;GENTICS.Aloha.prototype.dictionaries={};GENTICS.Aloha.prototype.settings={};GENTICS.Aloha.prototype.OSName="Unknown";GENTICS.Aloha.prototype.readyCallbacks=[];
GENTICS.Aloha.prototype.init=function(){if(jQuery.browser.webkit&&parseFloat(jQuery.browser.version)<532.5||jQuery.browser.mozilla&&parseFloat(jQuery.browser.version)<1.9||jQuery.browser.msie&&jQuery.browser.version<7||jQuery.browser.opera)alert("Sorry, your browser is not supported at the moment.");else{var a=this;jQuery("html").mousedown(function(){if(a.activeEditable&&!a.isMessageVisible()){a.activeEditable.blur();a.FloatingMenu.setScope("GENTICS.Aloha.empty");a.activeEditable=null}});if(typeof this.settings.base==
"undefined"||!this.settings.base){this.settings.base=GENTICS.Aloha.autobase;if(typeof GENTICS_Aloha_base!="undefined")this.settings.base=GENTICS_Aloha_base}this.Log.init();if(this.settings.errorhandling!=false)window.onerror=function(b,c,d){GENTICS.Aloha.Log.error(GENTICS.Aloha,"Error message: "+b+"\nURL: "+c+"\nLine Number: "+d);return true};if(navigator.appVersion.indexOf("Win")!=-1)this.OSName="Win";if(navigator.appVersion.indexOf("Mac")!=-1)this.OSName="Mac";if(navigator.appVersion.indexOf("X11")!=
-1)this.OSName="Unix";if(navigator.appVersion.indexOf("Linux")!=-1)this.OSName="Linux";GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"i18nReady",this.loadPlugins);GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"i18nPluginsReady",this.loadGui);this.initI18n()}};GENTICS.Aloha.prototype.loadPlugins=function(){this.PluginRegistry.init()};
GENTICS.Aloha.prototype.loadGui=function(){this.RepositoryManager.init();this.FloatingMenu.init();Ext.MessageBox.buttonText.yes=GENTICS.Aloha.i18n(this,"yes");Ext.MessageBox.buttonText.no=GENTICS.Aloha.i18n(this,"no");Ext.MessageBox.buttonText.cancel=GENTICS.Aloha.i18n(this,"cancel");Ext.ux.AlohaAttributeField.prototype.listEmptyText=GENTICS.Aloha.i18n(GENTICS.Aloha,"repository.no_item_found");Ext.ux.AlohaAttributeField.prototype.loadingText=GENTICS.Aloha.i18n(GENTICS.Aloha,"repository.loading")+
"...";this.ready=true;for(var a=0;a<this.editables.length;a++)this.editables[a].ready||this.editables[a].init();GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("ready",GENTICS.Aloha,null))};GENTICS.Aloha.prototype.activateEditable=function(a){for(var b=0;b<this.editables.length;b++)this.editables[b]!=a&&this.editables[b].isActive&&this.editables[b].blur();this.activeEditable=a};GENTICS.Aloha.prototype.getActiveEditable=function(){return this.activeEditable};
GENTICS.Aloha.prototype.deactivateEditable=function(){if(!(typeof this.activeEditable=="undefined"||this.activeEditable==null)){this.activeEditable.blur();this.FloatingMenu.setScope("GENTICS.Aloha.empty");this.activeEditable=null}};GENTICS.Aloha.prototype.getEditableById=function(a){for(var b=0;b<GENTICS.Aloha.editables.length;b++)if(GENTICS.Aloha.editables[b].getId()==a)return GENTICS.Aloha.editables[b];return null};GENTICS.Aloha.prototype.log=function(a,b,c){GENTICS.Aloha.Log.log(a,b,c)};
GENTICS.Aloha.prototype.identStr=function(a){if(a instanceof jQuery)a=a[0];if(!(a instanceof HTMLElement)){GENTICS.Aloha.Log.warn(this,"{"+a.toString()+"} provided is not an HTML element");return a.toString()}var b=a.tagName.toLowerCase();if(a.id)return b+"#"+a.id;if(a.className)return b+"."+a.className;return b};GENTICS.Aloha.prototype.trim=function(a){a=a.replace(/^\s+/,"");for(var b=a.length-1;b>=0;b--)if(/\S/.test(a.charAt(b))){a=a.substring(0,b+1);break}return a};
GENTICS.Aloha.prototype.initI18n=function(){if(typeof this.settings.i18n=="undefined"||!this.settings.i18n)this.settings.i18n={};if(typeof this.settings.i18n.available=="undefined"||!this.settings.i18n.available||!this.settings.i18n.available instanceof Array)this.settings.i18n.available=["en","de","fr","eo","fi","ru","it","pl"];if((typeof this.settings.i18n.current=="undefined"||!this.settings.i18n.current)&&typeof this.settings.i18n.acceptLanguage=="string"){var a=[],b=this.settings.i18n.acceptLanguage.split(",");
for(i=0;i<b.length;i++){var c=b[i].split(";");c[1]=typeof c[1]=="undefined"||!c[1]?1:parseFloat(c[1].substring(2,c[1].length));a.push(c)}a.sort(function(d,e){return e[1]-d[1]});for(i=0;i<a.length;i++)if(jQuery.inArray(a[i][0],this.settings.i18n.available)>=0){this.settings.i18n.current=a[i][0];break}}if(typeof this.settings.i18n.current=="undefined"||!this.settings.i18n.current)this.settings.i18n.current=navigator.language?navigator.language:navigator.userLanguage;(a=this.getLanguage(this.settings.i18n.current,
this.settings.i18n.available))?this.loadI18nFile(this.settings.base+"i18n/"+a+".dict",this,function(){GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("i18nReady",GENTICS.Aloha,null))}):GENTICS.Aloha.Log.error(this,"Could not determine actual language.")};
GENTICS.Aloha.prototype.getLanguage=function(a,b){if(!b instanceof Array){GENTICS.Aloha.Log.error(this,"Available languages must be an Array");return null}if(typeof a=="undefined"||!a)return b[0];for(var c=0;c<b.length;++c)if(a==b[c])return a;return b[0]};
GENTICS.Aloha.prototype.loadI18nFile=function(a,b,c){jQuery.ajax({datatype:"text",url:a,error:function(d,e){GENTICS.Aloha.Log.error(b,"Error while getting dictionary file "+a+": server returned "+e);typeof c=="function"&&c.call(b)},success:function(d){GENTICS.Aloha.Log.isInfoEnabled()&&GENTICS.Aloha.Log.info(b,"Loaded dictionary file "+a);GENTICS.Aloha.parseI18nFile(d,b);typeof c=="function"&&c.call(b)}})};
GENTICS.Aloha.prototype.parseI18nFile=function(a,b){a=a.replace(/\r/g,"");for(var c=a.split("\n"),d={},e=0;e<c.length;++e){var g=c[e],f=g.indexOf("=");if(f>0){var h=GENTICS.Aloha.trim(g.substring(0,f));g=GENTICS.Aloha.trim(g.substring(f+1,g.length));g=g.replace(/\\n/g,"\n");g=g.replace(/\\\\/g,"\\");if(d[h])GENTICS.Aloha.Log.warn(b,"Found duplicate key "+h+" in dictionary file, ignoring");else d[h]=g}}this.dictionaries[b.toString()]=d};
GENTICS.Aloha.prototype.i18n=function(a,b,c){var d=null;if(this.dictionaries[a.toString()])if(this.dictionaries[a.toString()][b])d=this.dictionaries[a.toString()][b];if(!d&&a!=GENTICS.Aloha)if(this.dictionaries[GENTICS.Aloha.toString()])if(this.dictionaries[GENTICS.Aloha.toString()][b])d=this.dictionaries[GENTICS.Aloha.toString()][b];if(d){if(typeof c!="undefined"&&c!=null)for(a=0;a<c.length;++a)if(typeof c[a]!="undefined"&&c[a]!=null){b=RegExp("\\{"+a+"\\}","g");var e=c[a].toString().replace(/\{/g,
"\\{");e=e.replace(/\}/g,"\\}");d=d.replace(b,e)}d=d.replace(/\{\d\}/g,"");d=d.replace(/\\\{/g,"{");return d=d.replace(/\\\}/g,"}")}else return"??? "+b+" ???"};GENTICS.Aloha.prototype.registerEditable=function(a){this.editables.push(a)};GENTICS.Aloha.prototype.unregisterEditable=function(a){a=this.editables.indexOf(a);a!=-1&&this.editables.splice(a,1)};
GENTICS.Aloha.prototype.showMessage=function(a){GENTICS.Aloha.FloatingMenu.obj&&GENTICS.Aloha.FloatingMenu.obj.css("z-index",8900);switch(a.type){case GENTICS.Aloha.Message.Type.ALERT:Ext.MessageBox.alert(a.title,a.text,a.callback);break;case GENTICS.Aloha.Message.Type.CONFIRM:Ext.MessageBox.confirm(a.title,a.text,a.callback);break;case GENTICS.Aloha.Message.Type.WAIT:Ext.MessageBox.wait(a.text,a.title);break;default:this.log("warn",this,"Unknown message type for message {"+a.toString()+"}");break}};
GENTICS.Aloha.prototype.hideMessage=function(){Ext.MessageBox.hide()};GENTICS.Aloha.prototype.isMessageVisible=function(){return Ext.MessageBox.isVisible()};GENTICS.Aloha.prototype.toString=function(){return"GENTICS.Aloha"};GENTICS.Aloha.prototype.isModified=function(){for(var a in this.editables)if(this.editables[a].isModified)if(this.editables[a].isModified())return true;return false};GENTICS.Aloha=new GENTICS.Aloha;jQuery.isAloha=true;
jQuery(document).ready(function(){!jQuery.isAloha&&window.console&&console.error&&console.error("Aloha ERROR: jQuery was included at least a second time after loading Aloha. This will cause serious problems. You must not load other versions of jQuery with Aloha.");Ext.isReady?GENTICS.Aloha.init():Ext.onReady(function(){GENTICS.Aloha.init()})});if(typeof GENTICS.Aloha.ui=="undefined")GENTICS.Aloha.ui=function(){};GENTICS.Aloha.ui.Button=function(a){this.init(a)};
GENTICS.Aloha.ui.Button.prototype.init=function(a){this.pressed=false;this.enabled=this.visible=true;this.listenerQueue=[];GENTICS.Utils.applyProperties(this,a);this.id=this.generateId()};GENTICS.Aloha.ui.Button.idCounter=0;GENTICS.Aloha.ui.Button.prototype.generateId=function(){GENTICS.Aloha.ui.Button.idCounter+=1;return"GENTICS_Aloha_ui_Button_"+GENTICS.Aloha.ui.Button.idCounter};
GENTICS.Aloha.ui.Button.prototype.setPressed=function(a){if(this.toggle){this.pressed=a;typeof this.extButton=="object"&&this.extButton.pressed!=a&&this.extButton.toggle(this.pressed)}};GENTICS.Aloha.ui.Button.prototype.isPressed=function(){if(this.toggle)return this.pressed;return false};GENTICS.Aloha.ui.Button.prototype.show=function(){this.visible=true};GENTICS.Aloha.ui.Button.prototype.hide=function(){this.visible=false};GENTICS.Aloha.ui.Button.prototype.isVisible=function(){return this.visible};
GENTICS.Aloha.ui.Button.prototype.enable=function(){this.enabled=true;typeof this.extButton=="object"&&this.extButton.enable()};GENTICS.Aloha.ui.Button.prototype.disable=function(){this.enabled=false;typeof this.extButton=="object"&&this.extButton.disable()};GENTICS.Aloha.ui.Button.prototype.isEnabled=function(){return this.enabled};
GENTICS.Aloha.ui.Button.prototype.getExtMenu=function(){if(typeof this.menu==="object")for(var a=new Ext.menu.Menu,b=0;b<this.menu.length;++b)a.addItem(new Ext.menu.Item(this.menu[b].getExtMenuConfigProperties()));return a};GENTICS.Aloha.ui.Button.prototype.getExtMenuConfigProperties=function(){var a=this;return{text:this.label,icon:this.icon,iconCls:this.iconClass,handler:function(){typeof a.onclick=="function"&&a.onclick()},menu:this.getExtMenu()}};
GENTICS.Aloha.ui.Button.prototype.getExtConfigProperties=function(){var a=this,b=this.getExtMenu();return{text:this.label,enableToggle:this.toggle,pressed:this.pressed,icon:this.icon,iconCls:this.iconClass,scale:this.scale||this.size,width:this.width||undefined,rowspan:this.rowspan||(this.size=="large"||this.size=="medium"?2:1),menu:b,handler:function(c,d){typeof a.onclick==="function"&&a.onclick.apply(a,[c,d]);a.pressed=!a.pressed},xtype:b&&typeof this.onclick=="function"?"splitbutton":"button",
tooltipType:"qtip",tooltip:this.tooltip,id:this.id,arrowAlign:this.arrowAlign||(this.size=="large"||this.size=="small"?"right":"bottom")}};
Ext.ux.GENTICSMultiSplitButton=Ext.extend(Ext.Component,{autoEl:{cls:"GENTICS_multisplit-wrapper"},ulObj:null,panelButton:null,wrapper:null,panelOpened:false,onRender:function(){Ext.ux.GENTICSMultiSplitButton.superclass.onRender.apply(this,arguments);this.wrapper=jQuery(this.el.dom);for(var a,b='<ul class="GENTICS_multisplit">',c=0;c<this.items.length;c++){a=this.items[c];if(typeof a.visible=="undefined")a.visible=true;a.wide||(b+='<li><button xmlns:ext="http://www.extjs.com/" class="'+a.iconClass+
'" ext:qtip="'+a.tooltip+'" gtxmultisplititem="'+c+'">&#160;</button></li>')}for(c=0;c<this.items.length;c++){a=this.items[c];if(a.wide)b+='<li><button xmlns:ext="http://www.extjs.com/" class="GENTICS_multisplit-wide '+a.iconClass+'" ext:qtip="'+a.tooltip+'" gtxmultisplititem="'+c+'">'+a.text+"</button></li>"}b+="</ul>";var d=this;GENTICS.Aloha.FloatingMenu.extTabPanel.on("move",function(){d.closePanel()});GENTICS.Aloha.FloatingMenu.extTabPanel.on("tabchange",function(){d.closePanel()});this.ulObj=
jQuery(this.el.createChild(b).dom).click(function(e){d.onClick(e)});this.panelButton=jQuery(this.el.createChild('<button class="GENTICS_multisplit_toggle GENTICS_multisplit_toggle_open">&#160;</button>').dom).click(function(){d.togglePanel()})},onClick:function(a){if(a.target.attributes.gtxmultisplititem){var b=jQuery(a.target);this.closePanel();b.hasClass("GENTICS_multisplit-wide")||this.setActiveDOMElement(b);this.items[a.target.attributes.gtxmultisplititem.value].click()}},setActiveItem:function(a){this.closePanel();
if(this.activeItem!=a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.setActiveDOMElement(jQuery(this.ulObj).find("[gtxmultisplititem="+b+"]"));this.activeItem=a;return}this.activeItem=null;this.setActiveDOMElement(null)}},setActiveDOMElement:function(a){for(var b=this;typeof b!="undefined";){if(b.hidden){this.activeDOMElement=a;return}b=b.ownerCt}jQuery(this.ulObj).find(".GENTICS_multisplit-activeitem").removeClass("GENTICS_multisplit-activeitem");a&&a.addClass("GENTICS_multisplit-activeitem");
if(!(a==null||a.parent().is(":hidden"))){if(a&&this.ulObj){this.ulObj.css("margin-top",0);a=a.position().top;this.ulObj.css({"margin-top":-a+6,height:46+a-6})}this.activeDOMElement=undefined}},togglePanel:function(){this.panelOpened?this.closePanel():this.openPanel()},openPanel:function(){if(!this.panelOpened){this.ulObj.appendTo(jQuery("body"));this.ulObj.addClass("GENTICS_multisplit-expanded");this.ulObj.mousedown(function(b){b.stopPropagation()});var a=this.wrapper.offset();this.ulObj.css({top:a.top-
1,left:a.left-1});this.ulObj.animate({height:this.ulObj.attr("scrollHeight")});this.panelButton.removeClass("GENTICS_multisplit_toggle_open");this.panelButton.addClass("GENTICS_multisplit_toggle_close");this.panelOpened=true}},closePanel:function(){if(this.panelOpened){this.ulObj.removeClass("GENTICS_multisplit-expanded");this.ulObj.appendTo(this.wrapper);this.panelButton.addClass("GENTICS_multisplit_toggle_open");this.panelButton.removeClass("GENTICS_multisplit_toggle_close");this.panelOpened=false}},
hideItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=false;jQuery("#"+this.id+" [gtxmultisplititem="+b+"]").parent().hide();return}},showItem:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b].name==a){this.items[b].visible=true;jQuery("#"+this.id+" [gtxmultisplititem="+b+"]").parent().show();return}}});Ext.reg("genticsmultisplitbutton",Ext.ux.GENTICSMultiSplitButton);
GENTICS.Aloha.ui.MultiSplitButton=function(a){GENTICS.Utils.applyProperties(this,a);this.id=this.generateId()};GENTICS.Aloha.ui.MultiSplitButton.idCounter=0;GENTICS.Aloha.ui.MultiSplitButton.prototype.generateId=function(){GENTICS.Aloha.ui.MultiSplitButton.idCounter+=1;return"GENTICS_Aloha_ui_MultiSplitButton_"+GENTICS.Aloha.ui.MultiSplitButton.idCounter};GENTICS.Aloha.ui.MultiSplitButton.prototype.getExtConfigProperties=function(){return{xtype:"genticsmultisplitbutton",items:this.items,id:this.id}};
GENTICS.Aloha.ui.MultiSplitButton.prototype.setActiveItem=function(a){this.extButton.setActiveItem(a)};GENTICS.Aloha.ui.MultiSplitButton.prototype.isVisible=function(){for(var a=0;a<this.items.length;a++)if(this.items[a].visible)return true;return false};GENTICS.Aloha.ui.MultiSplitButton.prototype.showItem=function(a){this.extButton.showItem(a)};GENTICS.Aloha.ui.MultiSplitButton.prototype.hideItem=function(a){this.extButton.hideItem(a)};
Ext.ux.AlohaAttributeField=Ext.extend(Ext.form.ComboBox,{typeAhead:false,mode:"remote",triggerAction:"all",width:300,hideTrigger:true,minChars:3,valueField:"id",displayField:"url",enableKeyEvents:true,store:new Ext.data.Store({proxy:new Ext.data.AlohaProxy,reader:new Ext.data.AlohaObjectReader}),tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item">',"<span><b>{name}</b><br />{url}</span>","</div></tpl>"),onSelect:function(a){this.setItem(a.data);typeof this.alohaButton.onSelect=="function"&&
this.alohaButton.onSelect.call(this.alohaButton,a.data);this.collapse()},listeners:{beforequery:function(a){if(this.noQuery)a.cancel=true;else this.store!=null&&this.store.proxy!=null&&this.store.proxy.setParams({objectTypeFilter:this.getObjectTypeFilter(),queryString:a.query})},afterrender:function(){var a=this;jQuery(this.wrap.dom.children[0]).blur(function(){a.triggerBlur()})},keydown:function(a,b){if(b.keyCode==13||b.keyCode==27)this.ALOHAwasExpanded=this.isExpanded()?true:false},keyup:function(a,
b){if((b.keyCode==13||b.keyCode==27)&&!this.ALOHAwasExpanded)setTimeout(function(){GENTICS.Aloha.activeEditable.obj[0].focus();GENTICS.Aloha.Selection.getRangeObject().select()},0);this.setAttribute(this.targetAttribute,this.wrap.dom.children[0].value)},focus:function(){var a=jQuery(this.getTargetObject());a.css("background-color");a&&a.context.style&&a.context.style["background-color"]&&a.attr("data-original-background-color",a.context.style["background-color"]);a.css("background-color","Highlight")},
blur:function(){var a=jQuery(this.getTargetObject());if(a){(color=a.attr("data-original-background-color"))?jQuery(a).css("background-color",color):jQuery(a).removeCss("background-color");jQuery(a).removeAttr("data-original-background-color")}},expand:function(){this.noQuery&&this.collapse()}},setItem:function(a,b){if(this.resourceItem=a){b=b?b:this.displayField;var c=a[b];this.setValue(c);this.setAttribute(this.targetAttribute,c);GENTICS.Aloha.RepositoryManager.markObject(this.targetObject,a)}},
getItem:function(){return this.resourceItem},setAttribute:function(a,b,c,d){if(this.targetObject){var e=true;if(typeof d!="undefined"){c=RegExp(c);d.match(c)||(e=false)}e?jQuery(this.targetObject).attr(a,b):jQuery(this.targetObject).removeAttr(a)}},setTargetObject:function(a,b){this.targetObject=a;this.targetAttribute=b;this.targetObject&&this.targetAttribute?this.setValue(jQuery(this.targetObject).attr(this.targetAttribute)):this.setValue("")},getTargetObject:function(){return this.targetObject},
setObjectTypeFilter:function(a){this.objectTypeFilter=a},getObjectTypeFilter:function(){return this.objectTypeFilter},noQuery:true});Ext.reg("alohaattributefield",Ext.ux.AlohaAttributeField);GENTICS.Aloha.ui.AttributeField=function(a){this.onSelect=null;this.listenerQueue=[];this.displayField=this.tpl=this.objectTypeFilter=null;this.init(a)};GENTICS.Aloha.ui.AttributeField.prototype=new GENTICS.Aloha.ui.Button;
GENTICS.Aloha.ui.AttributeField.prototype.getExtConfigProperties=function(){return{alohaButton:this,xtype:"alohaattributefield",rowspan:this.rowspan||undefined,width:this.width||undefined,id:this.id}};GENTICS.Aloha.ui.AttributeField.prototype.setTargetObject=function(a,b){this.extButton&&this.extButton.setTargetObject(a,b)};GENTICS.Aloha.ui.AttributeField.prototype.getTargetObject=function(){return this.extButton?this.extButton.getTargetObject():null};
GENTICS.Aloha.ui.AttributeField.prototype.focus=function(){if(this.extButton){this.extButton.focus();this.extButton.getValue().length>0&&this.extButton.selectText(0,this.extButton.getValue().length)}};GENTICS.Aloha.ui.AttributeField.prototype.addListener=function(a,b,c){if(this.extButton)this.extButton.addListener(a,b,null);else{listener={eventName:a,handler:b,scope:c,options:null};this.listenerQueue.push(listener)}};
GENTICS.Aloha.ui.AttributeField.prototype.setAttribute=function(a,b,c,d){this.extButton&&this.extButton.setAttribute(a,b,c,d)};GENTICS.Aloha.ui.AttributeField.prototype.setObjectTypeFilter=function(a){if(this.extButton){this.noQuery=false;this.extButton.setObjectType(a)}else{a||(a="all");this.objectTypeFilter=a}};GENTICS.Aloha.ui.AttributeField.prototype.setItem=function(a,b){this.extButton&&this.extButton.setItem(a,b)};
GENTICS.Aloha.ui.AttributeField.prototype.getItem=function(){if(this.extButton)return this.extButton.getItem();return null};GENTICS.Aloha.ui.AttributeField.prototype.getValue=function(){if(this.extButton)return this.extButton.getValue();return null};GENTICS.Aloha.ui.AttributeField.prototype.setValue=function(a){this.extButton&&this.extButton.setValue(a)};GENTICS.Aloha.ui.AttributeField.prototype.getQueryValue=function(){if(this.extButton)return this.extButton.wrap.dom.children[0].value;return null};
GENTICS.Aloha.ui.AttributeField.prototype.setDisplayField=function(a){return this.extButton?this.extButton.displayField=a:this.displayField=a};GENTICS.Aloha.ui.AttributeField.prototype.setTemplate=function(a){return this.extButton?this.extButton.tpl='<tpl for="."><div class="x-combo-list-item">'+a+"</div></tpl>":this.tpl='<tpl for="."><div class="x-combo-list-item">'+a+"</div></tpl>"};
GENTICS.Aloha.ui.Browser=function(){this.onSelect=null;var a=this;this.grid=new Ext.grid.GridPanel({region:"center",autoScroll:true,store:new Ext.data.Store({proxy:new Ext.data.AlohaProxy,reader:new Ext.data.AlohaObjectReader}),columns:[{id:"name",header:"Name",width:100,sortable:true,dataIndex:"name"},{header:"URL",renderer:function(b){return b},width:300,sortable:true,dataIndex:"url"}],stripeRows:true,autoExpandColumn:"name",height:350,width:600,title:"Objectlist",stateful:true,stateId:"grid",selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),
listeners:{dblclick:function(){a.onItemSelect()}}});this.grid.getSelectionModel().on({selectionchange:function(){a.grid.getSelectionModel().getSelected()?this.win.buttons[1].enable():this.win.buttons[1].disable()},scope:this});this.tree=new Ext.tree.TreePanel({region:"center",useArrows:true,autoScroll:true,animate:true,enableDD:true,containerScroll:true,border:false,loader:new Ext.tree.AlohaTreeLoader,root:{nodeType:"async",text:"Aloha Repositories",draggable:false,id:"aloha"},rootVisible:false,listeners:{beforeload:function(b){this.loader.baseParams=
{node:b.attributes}}}});this.tree.getSelectionModel().on({selectionchange:function(b,c){if(c){var d=c.attributes;a.grid.store.load({params:{inFolderId:d.id,objectTypeFilter:a.objectTypeFilter,repositoryId:d.repositoryId}})}},scope:this});this.nav=new Ext.Panel({title:"Navigation",region:"west",width:300,layout:"fit",collapsible:true,items:[this.tree]});this.win=new Ext.Window({title:"Resource Selector",layout:"border",width:800,height:300,closeAction:"hide",onEsc:function(){this.hide()},defaultButton:this.nav,
plain:true,initHidden:true,items:[this.nav,this.grid],buttons:[{text:"Close",handler:function(){a.win.hide()}},{text:"Select",disabled:true,handler:function(){a.onItemSelect()}}],toFront:function(){this.manager=this.manager||Ext.WindowMgr;this.manager.bringToFront(this);this.setZIndex(9999999999);return this}});this.onItemSelect=function(){var b=this.grid.getSelectionModel();b=(b=b?b.getSelected():null)?b.data:null;this.win.hide();typeof this.onSelect=="function"&&this.onSelect.call(this,b)}};
GENTICS.Aloha.ui.Browser.prototype.setObjectTypeFilter=function(a){this.objectTypeFilter=a};GENTICS.Aloha.ui.Browser.prototype.getObjectTypeFilter=function(){return this.objectTypeFilter};GENTICS.Aloha.ui.Browser.prototype.show=function(){this.win.show();this.win.toFront(true);this.win.focus()};
(function(a){function b(d){var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",d);e.setAttribute("media","all");return e}if(typeof a.GENTICS_Aloha_autoloadcss==="undefined"||a.GENTICS_Aloha_autoloadcss){a=GENTICS.Aloha.autobase||a.GENTICS_Aloha_base||"";var c=document.getElementsByTagName("head")[0];c.appendChild(b(a+"deps/extjs/resources/css/ext-all.css?v="+GENTICS.Aloha.version));c.appendChild(b(a+"deps/extjs/resources/css/xtheme-gray.css?v="+
GENTICS.Aloha.version));c.appendChild(b(a+"deps/prettyPhoto/resources/css/prettyPhoto.css?v="+GENTICS.Aloha.version));c.appendChild(b(a+"css/aloha.css?v="+GENTICS.Aloha.version))}})(window);GENTICS.Aloha.Editable=function(a){a.attr("id")||a.attr("id",GENTICS.Utils.guid());this.obj=a;this.ready=false;GENTICS.Aloha.registerEditable(this);this.init()};GENTICS.Aloha.Editable.prototype.isActive=false;GENTICS.Aloha.Editable.prototype.originalContent=null;GENTICS.Aloha.Editable.prototype.range=undefined;
GENTICS.Aloha.Editable.prototype.check=function(){for(var a=this.obj,b=a.get(0).nodeName.toLowerCase(),c=["a","abbr","address","article","aside","b","bdo","blockquote","cite","code","command","del","details","dfn","div","dl","em","footer","h1","h2","h3","h4","h5","h6","header","i","ins","menu","nav","p","pre","q","ruby","section","small","span","strong","sub","sup","var"],d=0;d<c.length;d++)if(b==c[d])return true;switch(b){case "label":case "button":break;case "textarea":var e=jQuery("<div/>").insertAfter(a);
e.html(a.val());a.hide();a.parents("form:first").submit(function(){var g=e.html();a.val(g)});this.obj=e;return true;default:break}return false};
GENTICS.Aloha.Editable.prototype.init=function(){var a=this;if(this.check(this.obj)){if(GENTICS.Aloha.ready){this.obj.addClass("GENTICS_editable");this.obj.attr("contentEditable",true);this.obj.mousedown(function(b){a.activate(b);b.stopPropagation()});this.obj.focus(function(b){a.activate(b)});this.obj.keydown(function(b){return GENTICS.Aloha.Markup.preProcessKeyStrokes(b)});this.obj.keyup(function(b){if(b.keyCode==27){GENTICS.Aloha.deactivateEditable();return false}});this.obj.GENTICS_contentEditableSelectionChange(function(b){GENTICS.Aloha.Selection.onChange(a.obj,
b);return a.obj});GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableCreated",GENTICS.Aloha,[this]));this.setUnmodified();this.ready=true}}else this.destroy()};
GENTICS.Aloha.Editable.prototype.destroy=function(){this.blur();this.ready=false;this.obj.removeClass("GENTICS_editable");this.obj.removeAttr("contentEditable");this.obj.unbind("mousedown");this.obj.unbind("focus");this.obj.unbind("keydown");this.obj.unbind("keyup");GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDestroyed",GENTICS.Aloha,[this]));GENTICS.Aloha.unregisterEditable(this)};GENTICS.Aloha.Editable.prototype.setUnmodified=function(){this.originalContent=this.getContents()};
GENTICS.Aloha.Editable.prototype.isModified=function(){return this.originalContent!=this.getContents()};GENTICS.Aloha.Editable.prototype.toString=function(){return"GENTICS.Aloha.Editable"};GENTICS.Aloha.Editable.prototype.isDisabled=function(){return this.obj.attr("contentEditable")=="false"||!this.obj.attr("contentEditable")};GENTICS.Aloha.Editable.prototype.disable=function(){this.isDisabled()||this.obj.attr("contentEditable","false")};
GENTICS.Aloha.Editable.prototype.enable=function(){this.isDisabled()&&this.obj.attr("contentEditable","true")};
GENTICS.Aloha.Editable.prototype.activate=function(){if(!(this.isActive||this.isDisabled())){var a=GENTICS.Aloha.getActiveEditable();GENTICS.Aloha.activateEditable(this);document.selection&&document.selection.createRange&&this.obj.mouseup();this.isActive=true;GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableActivated",GENTICS.Aloha,{oldActive:a,editable:this}));GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableActivated",this,{oldActive:GENTICS.Aloha.getActiveEditable()}))}};
GENTICS.Aloha.Editable.prototype.blur=function(){this.obj.blur();this.isActive=false;GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDeactivated",GENTICS.Aloha,{editable:this}));GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("editableDeactivated",this))};GENTICS.Aloha.Editable.prototype.empty=function(a){return null===a||GENTICS.Aloha.trim(a)==""||a=="<br>"};
GENTICS.Aloha.Editable.prototype.getContents=function(){var a=this.obj.clone(true);GENTICS.Aloha.PluginRegistry.makeClean(a);return a.html()};GENTICS.Aloha.Editable.prototype.getId=function(){return this.obj.attr("id")};GENTICS.Aloha.Event=function(a,b,c){this.name=a;this.source=b?b:GENTICS.Aloha;this.properties=c};GENTICS.Aloha.EventRegistry=function(){};GENTICS.Aloha.EventRegistry.prototype.subscribe=function(a,b,c){jQuery(a).bind(b,c)};
GENTICS.Aloha.EventRegistry.prototype.trigger=function(a){jQuery(a.source).trigger(a.name,a.properties)};GENTICS.Aloha.EventRegistry=new GENTICS.Aloha.EventRegistry;GENTICS.Aloha.FloatingMenu={};
GENTICS.Aloha.FloatingMenu.scopes={"GENTICS.Aloha.empty":{name:"GENTICS.Aloha.empty",extendedScopes:[],buttons:[]},"GENTICS.Aloha.global":{name:"GENTICS.Aloha.global",extendedScopes:["GENTICS.Aloha.empty"],buttons:[]},"GENTICS.Aloha.continuoustext":{name:"GENTICS.Aloha.continuoustext",extendedScopes:["GENTICS.Aloha.global"],buttons:[]}};GENTICS.Aloha.FloatingMenu.tabs=[];GENTICS.Aloha.FloatingMenu.tabMap={};GENTICS.Aloha.FloatingMenu.initialized=false;GENTICS.Aloha.FloatingMenu.allButtons=[];
GENTICS.Aloha.FloatingMenu.top=100;GENTICS.Aloha.FloatingMenu.left=100;GENTICS.Aloha.FloatingMenu.pinned=false;GENTICS.Aloha.FloatingMenu.window=jQuery(window);
GENTICS.Aloha.FloatingMenu.init=function(){this.currentScope="GENTICS.Aloha.global";var a=this;this.window.unload(function(){if(a.pinned){jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned","true");jQuery.cookie("GENTICS.Aloha.FloatingMenu.top",a.obj.offset().top);jQuery.cookie("GENTICS.Aloha.FloatingMenu.left",a.obj.offset().left);GENTICS.Aloha.Log.isInfoEnabled()&&GENTICS.Aloha.Log.info(this,"stored FloatingMenu pinned position {"+a.obj.offset().left+", "+a.obj.offset().top+"}")}else{jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned",
null);jQuery.cookie("GENTICS.Aloha.FloatingMenu.top",null);jQuery.cookie("GENTICS.Aloha.FloatingMenu.left",null)}a.userActivatedTab&&jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab",a.userActivatedTab)}).resize(function(){var b=a.calcFloatTarget(GENTICS.Aloha.Selection.getRangeObject());b&&a.floatTo(b)});this.generateComponent();this.initialized=true};GENTICS.Aloha.FloatingMenu.obj=null;GENTICS.Aloha.FloatingMenu.shadow=null;GENTICS.Aloha.FloatingMenu.panelBody=null;
GENTICS.Aloha.FloatingMenu.generateComponent=function(){var a=this;Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{minWidth:10});this.extTabPanel=new Ext.TabPanel({activeTab:0,width:400,plain:false,draggable:{insertProxy:false,onDrag:function(){var c=this.proxy.getEl();this.x=c.getLeft(true);this.y=c.getTop(true);GENTICS.Aloha.FloatingMenu.shadow.hide()},endDrag:function(){var c=GENTICS.Aloha.FloatingMenu.pinned?this.y-jQuery(document).scrollTop():this.y;a.left=this.x;a.top=c;this.panel.setPosition(this.x,
c);GENTICS.Aloha.FloatingMenu.refreshShadow();GENTICS.Aloha.FloatingMenu.shadow.show()}},floating:true,defaults:{autoScroll:true},layoutOnTabChange:true,shadow:false,cls:"GENTICS_floatingmenu ext-root",listeners:{tabchange:{fn:function(c,d){if(d.title!=a.autoActivatedTab){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(a,"User selected tab "+d.title);a.userActivatedTab=d.title}else GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(a,"Tab "+d.title+" was activated automatically");
a.autoActivatedTab=undefined;jQuery.each(a.allButtons,function(e,g){typeof g.button!="undefined"&&typeof g.button.extButton!="undefined"&&typeof g.button.extButton.setActiveDOMElement=="function"&&typeof g.button.extButton.activeDOMElement!="undefined"&&g.button.extButton.setActiveDOMElement(g.button.extButton.activeDOMElement)});GENTICS.Aloha.FloatingMenu.shadow.show();GENTICS.Aloha.FloatingMenu.refreshShadow()}}},enableTabScroll:true});jQuery.each(this.tabs,function(c,d){a.extTabPanel.add(d.getExtComponent())});
jQuery("body").append('<div id="GENTICS_floatingmenu_shadow" class="GENTICS_shadow">&#160;</div>');this.shadow=jQuery("#GENTICS_floatingmenu_shadow");var b=this.extTabPanel.add({title:"&#160;"});this.extTabPanel.render(document.body);jQuery(b.tabEl).addClass("GENTICS_floatingmenu_pin").html("&#160;").mousedown(function(c){a.togglePin();c.stopPropagation()});this.panelBody=jQuery(".GENTICS_floatingmenu .x-tab-panel-bwrap");this.doLayout();this.obj=jQuery(this.extTabPanel.getEl().dom);if(jQuery.cookie("GENTICS.Aloha.FloatingMenu.pinned")==
"true"){this.togglePin();this.top=parseInt(jQuery.cookie("GENTICS.Aloha.FloatingMenu.top"));this.left=parseInt(jQuery.cookie("GENTICS.Aloha.FloatingMenu.left"));if(this.top<30)this.top=30;if(this.left<0)this.left=0;GENTICS.Aloha.Log.isInfoEnabled()&&GENTICS.Aloha.Log.info(this,"restored FloatingMenu pinned position {"+this.left+", "+this.top+"}");this.refreshShadow()}if(jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab"))this.userActivatedTab=jQuery.cookie("GENTICS.Aloha.FloatingMenu.activeTab");
this.extTabPanel.setPosition(this.left,this.top);this.obj.mousedown(function(c){c.stopPropagation()});GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(c,d){if(!a.pinned){var e=a.calcFloatTarget(d);e&&a.floatTo(e)}})};GENTICS.Aloha.FloatingMenu.refreshShadow=function(){this.panelBody&&GENTICS.Aloha.FloatingMenu.shadow.css({top:this.top+24,left:this.left,width:this.panelBody.width()+"px",height:this.panelBody.height()+"px"})};
GENTICS.Aloha.FloatingMenu.togglePin=function(){var a=jQuery(".GENTICS_floatingmenu_pin");if(this.pinned){a.removeClass("GENTICS_floatingmenu_pinned");this.top=this.obj.offset().top;this.obj.css({top:this.top,position:"absolute"});this.shadow.css("position","absolute");this.refreshShadow();this.pinned=false}else{a.addClass("GENTICS_floatingmenu_pinned");this.top=this.obj.offset().top-this.window.scrollTop();this.obj.css({top:this.top,position:"fixed"});this.shadow.css("position","fixed");this.refreshShadow();
this.pinned=true}};GENTICS.Aloha.FloatingMenu.createScope=function(a,b){if(typeof b=="undefined")b=["GENTICS.Aloha.empty"];else if(typeof b=="string")b=[b];this.scopes[a]||(this.scopes[a]={name:a,extendedScopes:b,buttons:[]})};
GENTICS.Aloha.FloatingMenu.addButton=function(a,b,c,d){a=this.scopes[a];b={button:b,scopeVisible:false};this.allButtons.push(b);a.buttons.push(b);a=this.tabMap[c];if(typeof a=="undefined"){a=new GENTICS.Aloha.FloatingMenu.Tab(c);this.tabs.push(a);this.tabMap[c]=a}a.getGroup(d).addButton(b);this.initialized&&this.generateComponent()};
GENTICS.Aloha.FloatingMenu.doLayout=function(){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"doLayout called for FloatingMenu, scope is "+this.currentScope);var a=this,b=false,c=this.extTabPanel.getActiveTab(),d=false,e=false,g=false;jQuery.each(this.tabs,function(h,j){if(j.extPanel==c)d=j;var k=j.visible;if(j.doLayout()){e=true;if(!k){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(a,"showing tab strip for tab "+j.label);a.extTabPanel.unhideTabStripItem(j.extPanel)}if(b==
false)b=j;if(a.userActivatedTab==j.extPanel.title&&j.extPanel!=c)g=j}else if(k){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(a,"hiding tab strip for tab "+j.label);a.extTabPanel.hideTabStripItem(j.extPanel)}});if(g){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"Setting active tab to "+g.label);this.extTabPanel.setActiveTab(g.extPanel)}else if(typeof d=="object"&&typeof b=="object")if(!d.visible){GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"Setting active tab to "+
b.label);this.autoActivatedTab=b.extPanel.title;this.extTabPanel.setActiveTab(b.extPanel)}if(e&&this.extTabPanel.hidden){this.extTabPanel.show();this.refreshShadow();this.shadow.show();this.extTabPanel.setPosition(this.left,this.top)}else if(!e&&!this.extTabPanel.hidden){var f=this.extTabPanel.getPosition(true);this.left=f[0]<0?100:f[0];this.top=f[1]<0?100:f[1];this.extTabPanel.hide();this.shadow.hide()}this.extTabPanel.doLayout()};
GENTICS.Aloha.FloatingMenu.setScope=function(a){var b=this.scopes[a];if(typeof b!="undefined")if(this.currentScope!=a){this.currentScope=a;jQuery.each(this.allButtons,function(c,d){d.scopeVisible=false});this.setButtonScopeVisibility(b);this.doLayout()}};GENTICS.Aloha.FloatingMenu.setButtonScopeVisibility=function(a){var b=this;jQuery.each(a.buttons,function(c,d){d.scopeVisible=true});jQuery.each(a.extendedScopes,function(c,d){var e=b.scopes[d];typeof e=="object"&&b.setButtonScopeVisibility(e)})};
GENTICS.Aloha.FloatingMenu.nextFloatTargetObj=function(a,b){if(!a||a==b)return a;switch(a.nodeName.toLowerCase()){case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":case "p":case "div":case "td":case "pre":case "ul":case "ol":return a;default:return this.nextFloatTargetObj(a.parentNode,b)}};
GENTICS.Aloha.FloatingMenu.calcFloatTarget=function(a){if(!GENTICS.Aloha.activeEditable||typeof a.getCommonAncestorContainer=="undefined")return false;for(var b=0;b<GENTICS.Aloha.editables.length;b++)if(GENTICS.Aloha.editables[b].obj.get(0)==a.limitObject&&GENTICS.Aloha.editables[b].isDisabled())return false;a=jQuery(this.nextFloatTargetObj(a.getCommonAncestorContainer(),a.limitObject));b=GENTICS.Utils.Position.Scroll.top;var c=a.offset().top-this.obj.height()-50;if(c<b)c=a.offset().top+a.height()+
GENTICS.Utils.Position.ScrollCorrection.top;if(c>this.window.height()+this.window.scrollTop())return false;return{x:GENTICS.Aloha.activeEditable.obj.offset().left,y:c}};GENTICS.Aloha.FloatingMenu.floatTo=function(a){if(!this.pinned){var b=this;if(!this.floatedTo||this.floatedTo.x!=a.x||this.floatedTo.y!=a.y){this.obj.animate({top:a.y,left:a.x},{queue:false,step:function(c,d){if(d.prop=="top")b.top=d.now;else if(d.prop=="left")b.left=d.now;b.refreshShadow()}});this.floatedTo=a}}};
GENTICS.Aloha.FloatingMenu.Tab=function(a){this.label=a;this.groups=[];this.groupMap={};this.visible=true};GENTICS.Aloha.FloatingMenu.Tab.prototype.getGroup=function(a){var b=this.groupMap[a];if(typeof b=="undefined"){b=new GENTICS.Aloha.FloatingMenu.Group;this.groupMap[a]=b;this.groups.push(b)}return b};
GENTICS.Aloha.FloatingMenu.Tab.prototype.getExtComponent=function(){var a=this;if(typeof this.extPanel=="undefined"){this.extPanel=new Ext.Panel({tbar:[],title:this.label,style:"margin-top:0px",bodyStyle:"display:none",autoScroll:true});jQuery.each(this.groups,function(b,c){a.extPanel.getTopToolbar().add(c.getExtComponent())})}return this.extPanel};
GENTICS.Aloha.FloatingMenu.Tab.prototype.doLayout=function(){var a=this;GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"doLayout called for tab "+this.label);this.visible=false;jQuery.each(this.groups,function(b,c){a.visible|=c.doLayout()});if(GENTICS.Aloha.Log.isDebugEnabled())GENTICS.Aloha.Log.debug(this,"tab "+this.label+(this.visible?" is ":" is not ")+"visible now");return this.visible};GENTICS.Aloha.FloatingMenu.Group=function(){this.buttons=[]};
GENTICS.Aloha.FloatingMenu.Group.prototype.addButton=function(a){this.buttons.push(a)};
GENTICS.Aloha.FloatingMenu.Group.prototype.getExtComponent=function(){var a=this;if(typeof this.extButtonGroup=="undefined"){var b=[],c=0;jQuery.each(this.buttons,function(d,e){b.push(e.button.getExtConfigProperties());c+=e.button.size=="small"?1:2});this.extButtonGroup=new Ext.ButtonGroup({columns:Math.ceil(c/2),items:b});jQuery.each(this.buttons,function(d,e){e.button.extButton=a.extButtonGroup.findById(e.button.id);if(e.button.listenerQueue&&e.button.listenerQueue.length>0)for(;l=e.button.listenerQueue.shift();)e.button.extButton.addListener(l.eventName,
l.handler,l.scope,l.options);if(e.button.extButton.setObjectTypeFilter){if(e.button.objectTypeFilter)e.button.extButton.noQuery=false;if(e.button.objectTypeFilter=="all")e.button.objectTypeFilter=null;e.button.extButton.setObjectTypeFilter(e.button.objectTypeFilter);if(e.button.displayField)e.button.extButton.displayField=e.button.displayField;if(e.button.tpl)e.button.extButton.tpl=e.button.tpl}})}return this.extButtonGroup};
GENTICS.Aloha.FloatingMenu.Group.prototype.doLayout=function(){var a=false,b=this;jQuery.each(this.buttons,function(c,d){var e=b.extButtonGroup.findById(d.button.id),g=d.button.isVisible()&&d.scopeVisible;if(g&&e.hidden)e.show();else!g&&!e.hidden&&e.hide();a|=g});if(a&&this.extButtonGroup.hidden)this.extButtonGroup.show();else!a&&!this.extButtonGroup.hidden&&this.extButtonGroup.hide();return a};
document.attachEvent&&document.selection&&function(){function a(f){this._document=f;this.startContainer=this.endContainer=f.body;this.endOffset=d.getNodeLength(f.body)}function b(f){this.range=f;if(!f.collapsed){var h=f.commonAncestorContainer;this._next=f.startContainer==h&&!d.isDataNode(f.startContainer)?f.startContainer.childNodes[f.startOffset]:d.findClosestAncestor(h,f.startContainer);this._end=f.endContainer==h&&!d.isDataNode(f.endContainer)?f.endContainer.childNodes[f.endOffset]:d.findClosestAncestor(h,
f.endContainer).nextSibling}}function c(f){this._document=f;var h=this;f.attachEvent("onselectionchange",function(){h._selectionChangeHandler()})}var d={findChildPosition:function(f){for(var h=0;f=f.previousSibling;h++);return h},isDataNode:function(f){return f&&f.nodeValue!==null&&f.data!==null},isAncestorOf:function(f,h){return!d.isDataNode(f)&&(f.contains(d.isDataNode(h)?h.parentNode:h)||h.parentNode==f)},isAncestorOrSelf:function(f,h){return d.isAncestorOf(f,h)||f==h},findClosestAncestor:function(f,
h){if(d.isAncestorOf(f,h))for(;h&&h.parentNode!=f;)h=h.parentNode;return h},getNodeLength:function(f){return d.isDataNode(f)?f.length:f.childNodes.length},splitDataNode:function(f,h){if(!d.isDataNode(f))return false;var j=f.cloneNode(false);f.deleteData(h,f.length);j.deleteData(0,h);f.parentNode.insertBefore(j,f.nextSibling)}},e={convertToDOMRange:function(f,h){function j(m,n,o){var p=h.createElement("a"),q=n.duplicate();q.collapse(o);var r=q.parentElement();do{r.insertBefore(p,p.previousSibling);
q.moveToElementText(p)}while(q.compareEndPoints(o?"StartToStart":"StartToEnd",n)>0&&p.previousSibling);if(q.compareEndPoints(o?"StartToStart":"StartToEnd",n)==-1&&p.nextSibling){q.setEndPoint(o?"EndToStart":"EndToEnd",n);m[o?"setStart":"setEnd"](p.nextSibling,q.text.length)}else m[o?"setStartBefore":"setEndBefore"](p);p.parentNode.removeChild(p)}var k=new a(h);j(k,f,true);j(k,f,false);return k},convertFromDOMRange:function(f){function h(k,m,n){var o=m[n?"startContainer":"endContainer"],p=m[n?"startOffset":
"endOffset"],q=0,r=d.isDataNode(o)?o:o.childNodes[p],s=d.isDataNode(o)?o.parentNode:o;if(o.nodeType==3||o.nodeType==4)q=p;o=m._document.createElement("a");s.insertBefore(o,r);m=m._document.body.createTextRange();m.moveToElementText(o);o.parentNode.removeChild(o);k.setEndPoint(n?"StartToStart":"EndToStart",m);k[n?"moveStart":"moveEnd"]("character",q)}var j=f._document.body.createTextRange();h(j,f,true);h(j,f,false);return j}};a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.prototype=
{startContainer:null,startOffset:0,endContainer:null,endOffset:0,commonAncestorContainer:null,collapsed:false,_document:null,_refreshProperties:function(){this.collapsed=this.startContainer==this.endContainer&&this.startOffset==this.endOffset;for(var f=this.startContainer;f&&f!=this.endContainer&&!d.isAncestorOf(f,this.endContainer);)f=f.parentNode;this.commonAncestorContainer=f},setStart:function(f,h){this.startContainer=f;this.startOffset=h;this._refreshProperties()},setEnd:function(f,h){this.endContainer=
f;this.endOffset=h;this._refreshProperties()},setStartBefore:function(f){this.setStart(f.parentNode,d.findChildPosition(f))},setStartAfter:function(f){this.setStart(f.parentNode,d.findChildPosition(f)+1)},setEndBefore:function(f){this.setEnd(f.parentNode,d.findChildPosition(f))},setEndAfter:function(f){this.setEnd(f.parentNode,d.findChildPosition(f)+1)},selectNode:function(f){this.setStartBefore(f);this.setEndAfter(f)},selectNodeContents:function(f){this.setStart(f,0);this.setEnd(f,d.getNodeLength(f))},
collapse:function(f){f?this.setEnd(this.startContainer,this.startOffset):this.setStart(this.endContainer,this.endOffset)},cloneContents:function(){return function f(h){for(var j,k=document.createDocumentFragment();j=h.next();){j=j.cloneNode(!h.hasPartialSubtree());h.hasPartialSubtree()&&j.appendChild(f(h.getSubtreeIterator()));k.appendChild(j)}return k}(new b(this))},extractContents:function(){var f=this.cloneRange();this.startContainer!=this.commonAncestorContainer&&this.setStartAfter(d.findClosestAncestor(this.commonAncestorContainer,
this.startContainer));this.collapse(true);return function h(j){for(var k,m=document.createDocumentFragment();k=j.next();){j.hasPartialSubtree()?k=k.cloneNode(false):j.remove();j.hasPartialSubtree()&&k.appendChild(h(j.getSubtreeIterator()));m.appendChild(k)}return m}(new b(f))},deleteContents:function(){var f=this.cloneRange();this.startContainer!=this.commonAncestorContainer&&this.setStartAfter(d.findClosestAncestor(this.commonAncestorContainer,this.startContainer));this.collapse(true);(function h(j){for(;j.next();)j.hasPartialSubtree()?
h(j.getSubtreeIterator()):j.remove()})(new b(f))},insertNode:function(f){if(d.isDataNode(this.startContainer)){d.splitDataNode(this.startContainer,this.startOffset);this.startContainer.parentNode.insertBefore(f,this.startContainer.nextSibling)}else this.startContainer.insertBefore(f,this.startContainer.childNodes[this.startOffset]);this.setStart(this.startContainer,this.startOffset)},surroundContents:function(f){var h=this.extractContents();this.insertNode(f);f.appendChild(h);this.selectNode(f)},
compareBoundaryPoints:function(f,h){var j,k,m,n;switch(f){case a.START_TO_START:case a.START_TO_END:j=this.startContainer;k=this.startOffset;break;case a.END_TO_END:case a.END_TO_START:j=this.endContainer;k=this.endOffset;break}switch(f){case a.START_TO_START:case a.END_TO_START:m=h.startContainer;n=h.startOffset;break;case a.START_TO_END:case a.END_TO_END:m=h.endContainer;n=h.endOffset;break}return j.sourceIndex<m.sourceIndex?-1:j.sourceIndex==m.sourceIndex?k<n?-1:k==n?0:1:1},cloneRange:function(){var f=
new a(this._document);f.setStart(this.startContainer,this.startOffset);f.setEnd(this.endContainer,this.endOffset);return f},detach:function(){},toString:function(){return e.convertFromDOMRange(this).text},createContextualFragment:function(f){var h=(d.isDataNode(this.startContainer)?this.startContainer.parentNode:this.startContainer).cloneNode(false);h.innerHTML=f;for(f=this._document.createDocumentFragment();h.firstChild;)f.appendChild(h.firstChild);return f}};b.prototype={range:null,_current:null,
_next:null,_end:null,hasNext:function(){return!!this._next},next:function(){var f=this._current=this._next;this._next=this._current&&this._current.nextSibling!=this._end?this._current.nextSibling:null;if(d.isDataNode(this._current)){if(this.range.endContainer==this._current)(f=f.cloneNode(true)).deleteData(this.range.endOffset,f.length-this.range.endOffset);if(this.range.startContainer==this._current)(f=f.cloneNode(true)).deleteData(0,this.range.startOffset)}return f},remove:function(){if(d.isDataNode(this._current)&&
(this.range.startContainer==this._current||this.range.endContainer==this._current)){var f=this.range.startContainer==this._current?this.range.startOffset:0;this._current.deleteData(f,(this.range.endContainer==this._current?this.range.endOffset:this._current.length)-f)}else this._current.parentNode.removeChild(this._current)},hasPartialSubtree:function(){return!d.isDataNode(this._current)&&(d.isAncestorOrSelf(this._current,this.range.startContainer)||d.isAncestorOrSelf(this._current,this.range.endContainer))},
getSubtreeIterator:function(){var f=new a(this.range._document);f.selectNodeContents(this._current);d.isAncestorOrSelf(this._current,this.range.startContainer)&&f.setStart(this.range.startContainer,this.range.startOffset);d.isAncestorOrSelf(this._current,this.range.endContainer)&&f.setEnd(this.range.endContainer,this.range.endOffset);return new b(f)}};c.prototype={rangeCount:0,_document:null,_selectionChangeHandler:function(){this.rangeCount=this._selectionExists(this._document.selection.createRange())?
1:0},_selectionExists:function(f){return f.compareEndPoints("StartToEnd",f)!=0||f.parentElement().isContentEditable},addRange:function(f){var h=this._document.selection.createRange();f=e.convertFromDOMRange(f);if(this._selectionExists(h)){if(f.compareEndPoints("StartToStart",h)==-1)if(f.compareEndPoints("StartToEnd",h)>-1&&f.compareEndPoints("EndToEnd",h)==-1)h.setEndPoint("StartToStart",f);else f.compareEndPoints("EndToStart",h)<1&&f.compareEndPoints("EndToEnd",h)>-1&&h.setEndPoint("EndToEnd",f);
h.select()}else f.select()},removeAllRanges:function(){this._document.selection.empty()},getRangeAt:function(){var f=this._document.selection.createRange();if(this._selectionExists(f))return e.convertToDOMRange(f,this._document);return null},toString:function(){return this._document.selection.createRange().text}};document.createRange=function(){return new a(document)};var g=new c(document);window.getSelection=function(){return g}}();jQuery.fn.aloha=function(){return this.each(function(){new GENTICS.Aloha.Editable(jQuery(this))})};
jQuery.fn.GENTICS_aloha=function(){return this.each(function(){new GENTICS.Aloha.Editable(jQuery(this))})};jQuery.fn.mahalo=function(){return this.each(function(){if(jQuery(this).hasClass("GENTICS_editable"))for(var a=0;a<GENTICS.Aloha.editables.length;a++)GENTICS.Aloha.editables[a].obj.get(0)===this&&GENTICS.Aloha.editables[a].destroy()})};jQuery.fn.GENTICS_mahalo=function(){return this.each(function(){})};
jQuery.fn.GENTICS_contentEditableSelectionChange=function(a){var b=this;this.keyup(function(c){GENTICS.Aloha.Selection.getRangeObject();a(c)});this.dblclick(function(c){a(c)});this.mousedown(function(){b.selectionStarted=true});jQuery(document).mouseup(function(c){GENTICS.Aloha.Selection.eventOriginalTarget=b;b.selectionStarted&&a(c);GENTICS.Aloha.Selection.eventOriginalTarget=false;b.selectionStarted=false});return this};jQuery.fn.outerHTML=function(a){return a?this.before(a).remove():jQuery("<p>").append(this.eq(0).clone()).html()};
GENTICS.Aloha.Log=function(){};GENTICS.Aloha.Log.prototype.logHistory=null;GENTICS.Aloha.Log.prototype.highWaterMarkReached=false;
GENTICS.Aloha.Log.prototype.init=function(){if(typeof GENTICS.Aloha.settings.logLevels=="undefined"||!GENTICS.Aloha.settings.logLevels)GENTICS.Aloha.settings.logLevels={error:true,warn:true};if(typeof GENTICS.Aloha.settings.logHistory=="undefined"||!GENTICS.Aloha.settings.logHistory)GENTICS.Aloha.settings.logHistory={};if(!GENTICS.Aloha.settings.logHistory.maxEntries)GENTICS.Aloha.settings.logHistory.maxEntries=100;if(!GENTICS.Aloha.settings.logHistory.highWaterMark)GENTICS.Aloha.settings.logHistory.highWaterMark=
90;if(!GENTICS.Aloha.settings.logHistory.levels)GENTICS.Aloha.settings.logHistory.levels={error:true,warn:true};this.flushLogHistory()};
GENTICS.Aloha.Log.prototype.log=function(a,b,c){if(typeof a=="undefined"||!a)a="error";a=a.toLowerCase();if(GENTICS.Aloha.settings.logLevels[a]){this.addToLogHistory({level:a,component:b.toString(),message:c,date:new Date});switch(a){case "error":window.console&&console.error&&console.error(b.toString()+": "+c);break;case "warn":window.console&&console.warn&&console.warn(b.toString()+": "+c);break;case "info":window.console&&console.info&&console.info(b.toString()+": "+c);break;case "debug":window.console&&
console.log&&console.log(b.toString()+" ["+a+"]: "+c);break;default:window.console&&console.log&&console.log(b.toString()+" ["+a+"]: "+c);break}}};GENTICS.Aloha.Log.prototype.error=function(a,b){this.log("error",a,b)};GENTICS.Aloha.Log.prototype.warn=function(a,b){this.log("warn",a,b)};GENTICS.Aloha.Log.prototype.info=function(a,b){this.log("info",a,b)};GENTICS.Aloha.Log.prototype.debug=function(a,b){this.log("debug",a,b)};
GENTICS.Aloha.Log.prototype.isLogLevelEnabled=function(a){return GENTICS.Aloha.settings&&GENTICS.Aloha.settings.logLevels&&GENTICS.Aloha.settings.logLevels[a]==true};GENTICS.Aloha.Log.prototype.isErrorEnabled=function(){return this.isLogLevelEnabled("error")};GENTICS.Aloha.Log.prototype.isWarnEnabled=function(){return this.isLogLevelEnabled("warn")};GENTICS.Aloha.Log.prototype.isInfoEnabled=function(){return this.isLogLevelEnabled("info")};GENTICS.Aloha.Log.prototype.isDebugEnabled=function(){return this.isLogLevelEnabled("debug")};
GENTICS.Aloha.Log.prototype.addToLogHistory=function(a){if(!(GENTICS.Aloha.settings.logHistory.maxEntries<=0||!GENTICS.Aloha.settings.logHistory.levels[a.level])){this.logHistory.push(a);if(this.highWaterMarkReached==false)if(this.logHistory.length>=GENTICS.Aloha.settings.logHistory.maxEntries*GENTICS.Aloha.settings.logHistory.highWaterMark/100){GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("logFull",GENTICS.Aloha.Log));this.highWaterMarkReached=true}for(;this.logHistory.length>GENTICS.Aloha.settings.logHistory.maxEntries;)this.logHistory.shift()}};
GENTICS.Aloha.Log.prototype.getLogHistory=function(){return this.logHistory};GENTICS.Aloha.Log.prototype.flushLogHistory=function(){this.logHistory=[];this.highWaterMarkReached=false};GENTICS.Aloha.Log=new GENTICS.Aloha.Log;GENTICS.Aloha.Markup=function(){};GENTICS.Aloha.Markup.prototype.keyHandlers={};GENTICS.Aloha.Markup.prototype.addKeyHandler=function(a,b){this.keyHandlers[a]||(this.keyHandlers[a]=[]);this.keyHandlers[a].push(b)};
GENTICS.Aloha.Markup.prototype.insertBreak=function(){var a=GENTICS.Aloha.Selection.rangeObject;a.isCollapsed()||this.removeSelectedMarkup();var b=jQuery("<br/>");GENTICS.Utils.Dom.insertIntoDOM(b,a,GENTICS.Aloha.activeEditable.obj);var c=GENTICS.Utils.Dom.searchAdjacentTextNode(b.parent().get(0),GENTICS.Utils.Dom.getIndexInParent(b.get(0))+1,false);if(c){var d=c.data.search(/\S/);if(d>0)c.data=c.data.substring(d)}a.startContainer=a.endContainer=b.get(0).parentNode;a.startOffset=a.endOffset=GENTICS.Utils.Dom.getIndexInParent(b.get(0))+
1;a.correctRange();a.clearCaches();a.select()};
GENTICS.Aloha.Markup.prototype.preProcessKeyStrokes=function(a){if(a.type!="keydown")return false;var b=GENTICS.Aloha.Selection.rangeObject;if(this.keyHandlers[a.keyCode])for(var c=this.keyHandlers[a.keyCode],d=0;d<c.length;++d)if(!c[d](a))return false;switch(a.keyCode){case 13:if(a.shiftKey){GENTICS.Aloha.Log.debug(this,"... got a smoking Shift+Enter, Cowboy");b.isCollapsed()||this.removeSelectedMarkup();GENTICS.Aloha.Selection.updateSelection(false,true);this.processShiftEnter(b)}else{GENTICS.Aloha.Log.debug(this,
"... got a lonely Enter, Mum");b.isCollapsed()||this.removeSelectedMarkup();GENTICS.Aloha.Selection.updateSelection(false,true);this.processEnter(b)}return false}return true};GENTICS.Aloha.Markup.prototype.processShiftEnter=function(a){this.insertHTMLBreak(a.getSelectionTree(),a)};
GENTICS.Aloha.Markup.prototype.processEnter=function(a){if(a.splitObject){jQuery.browser.msie&&GENTICS.Utils.Dom.isListElement(a.splitObject)&&jQuery(a.splitObject).append(jQuery(document.createTextNode("")));this.splitRangeObject(a)}else this.insertHTMLBreak(a.getSelectionTree(),a)};GENTICS.Aloha.Markup.prototype.insertHTMLCode=function(a){var b=GENTICS.Aloha.Selection.rangeObject;this.insertHTMLBreak(b.getSelectionTree(),b,jQuery(a))};
GENTICS.Aloha.Markup.prototype.insertHTMLBreak=function(a,b,c){c=c?c:jQuery("<br />");for(var d=0;d<a.length;d++){var e=a[d],g=e.domobj?jQuery(e.domobj):undefined;if(e.selection!=="none")if(e.selection=="collapsed"){d>0?jQuery(a[d-1].domobj).after(c):jQuery(a[1].domobj).before(c);b.startContainer=b.endContainer=c[0].parentNode;b.startOffset=b.endOffset=GENTICS.Utils.Dom.getIndexInParent(c[0])+1;b.correctRange()}else if(e.domobj&&e.domobj.nodeType===3){e.domobj.nextSibling&&e.domobj.nextSibling.nodeType==
1&&GENTICS.Aloha.Selection.replacingElements[e.domobj.nextSibling.nodeName.toLowerCase()]&&g.after("<br/>");for(var f=e.domobj;f;)if(f.nextSibling)f=false;else{f=f.parentNode;if(f===b.limitObject)f=false;if(GENTICS.Utils.Dom.isBlockLevelElement(f))break}f&&jQuery(f).append("<br/>");g.between(c,e.startOffset);e=0;for(g=c[0];g;){g=g.previousSibling;e++}b.startContainer=c[0].parentNode;b.endContainer=c[0].parentNode;b.startOffset=e;b.endOffset=e;b.correctRange()}else if(e.domobj&&e.domobj.nodeType===
1){if(g.parent().find("br.GENTICS_ephemera").length===0){jQuery(b.limitObject).find("br.GENTICS_ephemera").remove();jQuery(b.commonAncestorContainer).append(this.getFillUpElement(b.splitObject))}g.after(c);b.startContainer=b.commonAncestorContainer;b.endContainer=b.startContainer;b.startOffset=d+2;b.endOffset=d+2;b.update()}}b.select()};
GENTICS.Aloha.Markup.prototype.getSelectedText=function(){var a=GENTICS.Aloha.Selection.rangeObject;if(a.isCollapsed())return false;return this.getFromSelectionTree(a.getSelectionTree(),true)};
GENTICS.Aloha.Markup.prototype.getFromSelectionTree=function(a,b){for(var c="",d=0;d<a.length;d++){var e=a[d];if(e.selection=="partial")if(e.domobj.nodeType==3)c+=e.domobj.data.substring(e.startOffset,e.endOffset);else{if(e.domobj.nodeType==1&&e.children)if(b)c+=this.getFromSelectionTree(e.children,b);else{var g=jQuery(e.domobj).clone(false).empty();g.html(this.getFromSelectionTree(e.children,b));c+=g.outerHTML()}}else if(e.selection=="full")if(e.domobj.nodeType==3)c+=jQuery(e.domobj).text();else if(e.domobj.nodeType==
1&&e.children)c+=b?jQuery(e.domobj).text():jQuery(e.domobj).outerHTML()}return c};GENTICS.Aloha.Markup.prototype.getSelectedMarkup=function(){var a=GENTICS.Aloha.Selection.rangeObject;if(a.isCollapsed())return false;return this.getFromSelectionTree(a.getSelectionTree(),false)};
GENTICS.Aloha.Markup.prototype.removeSelectedMarkup=function(){var a=GENTICS.Aloha.Selection.rangeObject;if(!a.isCollapsed()){var b=new GENTICS.Aloha.Selection.SelectionRange;this.removeFromSelectionTree(a.getSelectionTree(),b);b.update();GENTICS.Utils.Dom.doCleanup({merge:true,removeempty:true},GENTICS.Aloha.Selection.rangeObject);GENTICS.Aloha.Selection.rangeObject=b;b.correctRange();b.update();b.select();GENTICS.Aloha.Selection.updateSelection()}};
GENTICS.Aloha.Markup.prototype.removeFromSelectionTree=function(a,b){for(var c=undefined,d=0;d<a.length;d++){var e=a[d];if(e.selection=="partial")if(e.domobj.nodeType==3){var g="";if(e.startOffset>0)g+=e.domobj.data.substring(0,e.startOffset);if(e.endOffset<e.domobj.data.length)g+=e.domobj.data.substring(e.endOffset,e.domobj.data.length);e.domobj.data=g;if(!b.startContainer){b.startContainer=b.endContainer=e.domobj;b.startOffset=b.endOffset=e.startOffset}}else{if(e.domobj.nodeType==1&&e.children){this.removeFromSelectionTree(e.children,
b);if(c){if(c.nodeName==e.domobj.nodeName){jQuery(c).append(jQuery(e.domobj).contents());jQuery(e.domobj).remove()}}else c=e.domobj}}else if(e.selection=="full"){if(!b.startContainer)if(g=GENTICS.Utils.Dom.searchAdjacentTextNode(e.domobj.parentNode,GENTICS.Utils.Dom.getIndexInParent(e.domobj)+1,false,{blocklevel:false})){b.startContainer=b.endContainer=g;b.startOffset=b.endOffset=0}else{b.startContainer=b.endContainer=e.domobj.parentNode;b.startOffset=b.endOffset=GENTICS.Utils.Dom.getIndexInParent(e.domobj)+
1}jQuery(e.domobj).remove()}}};
GENTICS.Aloha.Markup.prototype.splitRangeObject=function(a){jQuery(a.splitObject);a.update(a.splitObject);var b=a.getSelectionTree(),c=this.getSplitFollowUpContainer(a);this.splitRangeObjectHelper(b,a,c);c.hasClass("preparedForRemoval")&&c.removeClass("preparedForRemoval");b=this.getInsertAfterObject(a,c);jQuery(c).insertAfter(b);a.splitObject.nodeName.toLowerCase()==="li"&&!GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(a.splitObject,c)&&jQuery(a.splitObject).remove();a.startContainer=
c.textNodes(true,true).first().get(0);if(!a.startContainer)a.startContainer=c.textNodes(false).first().parent().get(0);if(a.startContainer){a.endContainer=a.startContainer;a.startOffset=0;a.endOffset=0}else{a.startContainer=a.endContainer=c.parent().get(0);a.startOffset=a.endOffset=GENTICS.Utils.Dom.getIndexInParent(c.get(0))}a.update();a.select()};
GENTICS.Aloha.Markup.prototype.getInsertAfterObject=function(a,b){for(var c=0;c<a.markupEffectiveAtStart.length;c++){el=a.markupEffectiveAtStart[c];if(el===a.splitObject)var d=true;if(d)if(GENTICS.Aloha.Selection.canTag1WrapTag2(jQuery(el).parent()[0].nodeName,b[0].nodeName))return el}return false};GENTICS.Aloha.Markup.prototype.getFillUpElement=function(){return jQuery.browser.msie?false:jQuery('<br class="GENTICS_ephemera" />')};
GENTICS.Aloha.Markup.prototype.removeElementContentWhitespaceObj=function(a){for(var b=0,c=[],d=0;d<a.length;d++)if(a[d].isElementContentWhitespace)c[c.length]=d;for(d=0;d<c.length;d++){a.splice(c[d]-b,1);b++}};
GENTICS.Aloha.Markup.prototype.splitRangeObjectHelper=function(a,b,c,d){c||GENTICS.Aloha.Log.warn(this,"no followUpContainer, no inBetweenMarkup, nothing to do...");var e=this.getFillUpElement(b.splitObject),g=jQuery(b.splitObject),f=false;if(a.length>0){var h=c.contents();h.length!==a.length&&this.removeElementContentWhitespaceObj(h);for(var j=0;j<a.length;j++){var k=a[j];if(k.selection==="none"&&f===false||k.domobj&&k.domobj.nodeType===3&&k===a[a.length-1]&&k.startOffset===k.domobj.data.length)if(c.textNodes().length>
1)h.eq(j).remove();else if(GENTICS.Utils.Dom.isSplitObject(c[0]))e?c.html(e):c.empty();else{c.empty();c.addClass("preparedForRemoval")}else if(k.selection!=="none"){if(k.domobj&&k.domobj.nodeType===3&&k.startOffset!==undefined){f=k.domobj.data;if(k.startOffset>0)k.domobj.data=f.substr(0,k.startOffset);else if(a.length>1)jQuery(k.domobj).remove();else{var m=jQuery(k.domobj).parent();if(GENTICS.Utils.Dom.isSplitObject(m[0]))e?m.html(e):m.empty();else m.remove()}if(f.length-k.startOffset>0)h[j].data=
f.substr(k.startOffset,f.length);else if(h.length>1)h.eq(j).remove();else if(GENTICS.Utils.Dom.isBlockLevelElement(c[0]))e?c.html(e):c.empty();else{c.empty();c.addClass("preparedForRemoval")}}f=true;k.children.length>0&&this.splitRangeObjectHelper(k.children,b,h.eq(j),d)}else if(k.selection==="none"&&f===true)jqObj=jQuery(k.domobj).remove()}}else GENTICS.Aloha.Log.error(this,"can not split splitObject due to an empty selection tree");g.find("br.GENTICS_ephemera:gt(0)").remove();c.find("br.GENTICS_ephemera:gt(0)").remove();
g.find(".preparedForRemoval").remove();c.find(".preparedForRemoval").remove();g.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(g[0])&&e&&g.html(e);c.contents().length===0&&GENTICS.Utils.Dom.isSplitObject(c[0])&&e&&c.html(e)};
GENTICS.Aloha.Markup.prototype.getSplitFollowUpContainer=function(a){switch(a.splitObject.nodeName.toLowerCase()){case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":var b=jQuery(a.splitObject).textNodes().last()[0];if(b&&a.startContainer===b&&a.startOffset===b.length){b=jQuery("<p></p>");a=jQuery(a.splitObject).clone().contents();b.append(a);return b}break;case "li":if(a.startContainer.nodeName.toLowerCase()==="br"&&jQuery(a.startContainer).hasClass("GENTICS_ephemera")){b=jQuery("<p></p>");
a=jQuery(a.splitObject).clone().contents();b.append(a);return b}if(!a.splitObject.nextSibling&&jQuery.trim(jQuery(a.splitObject).text()).length==0)return b=jQuery("<p></p>")}return jQuery(a.splitObject).clone()};GENTICS.Aloha.Markup.prototype.transformDomObject=function(a,b){var c=jQuery(a),d=jQuery("<"+b+"></"+b+">");c.contents().appendTo(d);c.replaceWith(d);return d};GENTICS.Aloha.Markup.prototype.toString=function(){return"GENTICS.Aloha.Markup"};GENTICS.Aloha.Markup=new GENTICS.Aloha.Markup;
GENTICS.Aloha.Message=function(a){this.title=a.title;this.text=a.text;this.type=a.type;this.callback=a.callback};GENTICS.Aloha.Message.Type={CONFIRM:"confirm",ALERT:"alert",WAIT:"wait"};GENTICS.Aloha.Message.prototype.toString=function(){return this.type+": "+this.message};GENTICS.Aloha.MessageLine=function(){this.messages=[]};
GENTICS.Aloha.MessageLine.prototype.add=function(a){for(this.messages[this.messages.length]=a;this.messages.length>4;)this.messages.shift();jQuery("#gtx_aloha_messageline").empty();for(a=0;a<this.messages.length;a++)jQuery("#gtx_aloha_messageline").append(this.messages[a].toString()+"<br/>")};GENTICS.Aloha.MessageLine=new GENTICS.Aloha.MessageLine;GENTICS.Aloha.PluginRegistry=function(){this.plugins=[]};
GENTICS.Aloha.PluginRegistry.prototype.register=function(a){a instanceof GENTICS.Aloha.Plugin&&this.plugins.push(a)};
GENTICS.Aloha.PluginRegistry.prototype.init=function(){for(var a=0,b=this.plugins.length,c=0;c<this.plugins.length;c++){var d=this.plugins[c];if(GENTICS.Aloha.settings.plugins==undefined)GENTICS.Aloha.settings.plugins={};d.settings=GENTICS.Aloha.settings.plugins[d.prefix];if(d.settings==undefined)d.settings={};if(d.settings.enabled==undefined)d.settings.enabled=true;var e=d.languages?GENTICS.Aloha.getLanguage(GENTICS.Aloha.settings.i18n.current,d.languages):null;if(e)GENTICS.Aloha.loadI18nFile(GENTICS.Aloha.settings.base+
"plugins/"+d.basePath+"/i18n/"+e+".dict",d,function(g){return function(){d.settings.enabled==true&&g.init();++a==b&&GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("i18nPluginsReady",GENTICS.Aloha,null))}}(d));else{GENTICS.Aloha.Log.warn(this,"Could not determine actual language, no languages available for plugin "+d);d.settings.enabled==true&&d.init();++a==b&&GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("i18nPluginsReady",GENTICS.Aloha,d))}}};
GENTICS.Aloha.PluginRegistry.prototype.makeClean=function(a){for(var b=0;b<this.plugins.length;b++){var c=this.plugins[b];GENTICS.Aloha.Log.isDebugEnabled()&&GENTICS.Aloha.Log.debug(this,"Passing contents of HTML Element with id { "+a.attr("id")+" } for cleaning to plugin { "+c.prefix+" }");c.makeClean(a)}};GENTICS.Aloha.PluginRegistry=new GENTICS.Aloha.PluginRegistry;GENTICS.Aloha.PluginRegistry.toString=function(){return"com.gentics.aloha.PluginRegistry"};
GENTICS.Aloha.Plugin=function(a,b){this.prefix=a;this.basePath=b?b:a;GENTICS.Aloha.PluginRegistry.register(this)};GENTICS.Aloha.Plugin.prototype.settings=null;GENTICS.Aloha.Plugin.prototype.init=function(){};
GENTICS.Aloha.Plugin.prototype.getEditableConfig=function(a){var b=[],c=false;this.settings.editables&&jQuery.each(this.settings.editables,function(d,e){if(a.is(d)){c=true;b=jQuery.merge(b,e)}});c||(b=typeof this.settings.config=="undefined"||!this.settings.config?this.config:this.settings.config);return b};GENTICS.Aloha.Plugin.prototype.makeClean=function(){};GENTICS.Aloha.Plugin.prototype.getUID=function(a){return this.prefix+"."+a};
GENTICS.Aloha.Plugin.prototype.i18n=function(a,b){return GENTICS.Aloha.i18n(this,a,b)};GENTICS.Aloha.Plugin.prototype.toString=function(){return this.prefix};GENTICS.Aloha.Plugin.prototype.log=function(a,b){GENTICS.Aloha.Log.log(a,this,b)};jQuery.fn.zap=function(){return this.each(function(){jQuery(this.childNodes).insertBefore(this)}).remove()};
jQuery.fn.textNodes=function(a,b){var c=[];(function(d){if(d.nodeType==3&&jQuery.trim(d.data)!=""&&!b||d.nodeType==3&&b||d.nodeName=="BR"&&!a)c.push(d);else for(var e=0;e<d.childNodes.length;++e)arguments.callee(d.childNodes[e])})(this[0]);return jQuery(c)};
GENTICS.Aloha.Selection=function(){this.rangeObject={};this.tagHierarchy={textNode:[],abbr:["textNode"],b:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","strong"],pre:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","code"],blockquote:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u","cite","q","code","abbr","p","h1","h2","h3","h4","h5","h6"],ins:["textNode","b","i","em",
"sup","sub","br","span","img","a","u","p","h1","h2","h3","h4","h5","h6"],ul:["li"],ol:["li"],li:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","h1","h2","h3","h4","h5","h6","del","ins","u"],tr:["td","th"],table:["tr"],div:["textNode","b","i","em","sup","sub","br","span","img","ul","ol","table","h1","h2","h3","h4","h5","h6","del","ins","u","p","div","pre","blockquote"],h1:["textNode","b","i","em","sup","sub","br","span","img","a","del","ins","u"]};this.tagHierarchy={textNode:this.tagHierarchy.textNode,
abbr:this.tagHierarchy.abbr,br:this.tagHierarchy.textNode,img:this.tagHierarchy.textNode,b:this.tagHierarchy.b,strong:this.tagHierarchy.b,code:this.tagHierarchy.b,q:this.tagHierarchy.b,blockquote:this.tagHierarchy.blockquote,cite:this.tagHierarchy.b,i:this.tagHierarchy.b,em:this.tagHierarchy.b,sup:this.tagHierarchy.b,sub:this.tagHierarchy.b,span:this.tagHierarchy.b,del:this.tagHierarchy.del,ins:this.tagHierarchy.ins,u:this.tagHierarchy.b,p:this.tagHierarchy.b,pre:this.tagHierarchy.pre,a:this.tagHierarchy.b,
ul:this.tagHierarchy.ul,ol:this.tagHierarchy.ol,li:this.tagHierarchy.li,td:this.tagHierarchy.li,div:this.tagHierarchy.div,h1:this.tagHierarchy.h1,h2:this.tagHierarchy.h1,h3:this.tagHierarchy.h1,h4:this.tagHierarchy.h1,h5:this.tagHierarchy.h1,h6:this.tagHierarchy.h1,table:this.tagHierarchy.table};this.replacingElements={h1:["p","h1","h2","h3","h4","h5","h6","pre"],blockquote:["blockquote"]};this.replacingElements={h1:this.replacingElements.h1,h2:this.replacingElements.h1,h3:this.replacingElements.h1,
h4:this.replacingElements.h1,h5:this.replacingElements.h1,h6:this.replacingElements.h1,pre:this.replacingElements.h1,p:this.replacingElements.h1,blockquote:this.replacingElements.blockquote};this.allowedToStealElements={h1:["textNode"]};this.allowedToStealElements={h1:this.allowedToStealElements.h1,h2:this.allowedToStealElements.h1,h3:this.allowedToStealElements.h1,h4:this.allowedToStealElements.h1,h5:this.allowedToStealElements.h1,h6:this.allowedToStealElements.h1,p:this.tagHierarchy.b}};
GENTICS.Aloha.Selection.prototype.SelectionTree=function(){this.domobj={};this.children=[]};GENTICS.Aloha.Selection.prototype.onChange=function(a,b){if(this.updateSelectionTimeout){window.clearTimeout(this.updateSelectionTimeout);this.updateSelectionTimeout=undefined}this.updateSelectionTimeout=window.setTimeout(function(){GENTICS.Aloha.Selection.updateSelection(b)},5)};
GENTICS.Aloha.Selection.prototype.updateSelection=function(a){var b=this.rangeObject=new GENTICS.Aloha.Selection.SelectionRange(true);b.update();GENTICS.Aloha.FloatingMenu.setScope("GENTICS.Aloha.continuoustext");GENTICS.Aloha.EventRegistry.trigger(new GENTICS.Aloha.Event("selectionChanged",GENTICS.Aloha,[b,a]));return true};
GENTICS.Aloha.Selection.prototype.getSelectionTree=function(a){if(!a)return this.rangeObject.getSelectionTree();if(!a.commonAncestorContainer){GENTICS.Aloha.Log.error(this,"the rangeObject is missing the commonAncestorContainer");return false}this.inselection=false;if(GENTICS.Utils.Dom.doCleanup({mergetext:true},a)){this.rangeObject.update();this.rangeObject.select()}return this.recursiveGetSelectionTree(a,a.commonAncestorContainer)};
GENTICS.Aloha.Selection.prototype.recursiveGetSelectionTree=function(a,b){var c=0,d=this,e=[];jQuery(b).contents().each(function(g){var f="none",h=false,j=false,k=false;if(a.isCollapsed()&&b===a.startContainer&&a.startOffset==g){e[c]=new GENTICS.Aloha.Selection.SelectionTree;e[c].selection="collapsed";e[c].domobj=undefined;d.inselection=false;k=true;c++}if(!d.inselection&&!k)switch(this.nodeType){case 3:if(this===a.startContainer){d.inselection=true;f=a.startOffset>0?"partial":"full";h=a.startOffset;
j=this.length}break;case 1:if(this===a.startContainer&&a.startOffset==0){d.inselection=true;f="full"}if(b===a.startContainer&&a.startOffset==g){d.inselection=true;f="full"}break}if(d.inselection&&!k){if(f=="none")f="full";switch(this.nodeType){case 3:if(this===a.endContainer){d.inselection=false;if(a.endOffset<this.length)f="partial";if(h===false)h=0;j=a.endOffset}break;case 1:if(this===a.endContainer&&a.endOffset==0)d.inselection=false;break}if(b===a.endContainer&&a.endOffset<=g){d.inselection=false;
f="none"}}e[c]=new GENTICS.Aloha.Selection.SelectionTree;e[c].domobj=this;e[c].selection=f;if(f=="partial"){e[c].startOffset=h;e[c].endOffset=j}e[c].children=d.recursiveGetSelectionTree(a,this);if(e[c].children.length>0){h=f=g=false;for(j=0;j<e[c].children.length;++j)switch(e[c].children[j].selection){case "none":g=true;break;case "full":h=true;break;case "partial":f=true;break}if(f||h&&g)e[c].selection="partial";else if(h&&!f&&!g)e[c].selection="full"}c++});if(a.isCollapsed()&&b===a.startContainer&&
a.startOffset==b.childNodes.length){e[c]=new GENTICS.Aloha.Selection.SelectionTree;e[c].selection="collapsed";e[c].domobj=undefined}return e};GENTICS.Aloha.Selection.prototype.getRangeObject=function(){return this.rangeObject};
GENTICS.Aloha.Selection.prototype.isRangeObjectWithinMarkup=function(a,b,c,d,e){domObj=!b?a.startContainer:a.endContainer;typeof d!=="undefined"&&typeof d!=="function"&&GENTICS.Aloha.Log.error(this,"parameter tagComparator is not a function");var g=this;if(typeof d==="undefined")d=function(j,k){return g.standardTextLevelSemanticsComparator(j,k)};a=jQuery(domObj).parents();var f=false,h=-1;g=this;a.length>0&&a.each(function(){if(this===e){GENTICS.Aloha.Log.debug(g,"reached limit dom obj");return false}if(d(this,
c)){if(f===false)f=[];GENTICS.Aloha.Log.debug(g,"reached object equal to markup");h++;f[h]=this;return true}});return f};
GENTICS.Aloha.Selection.prototype.standardSectionsAndGroupingContentComparator=function(a,b){if(a.nodeType===1){if(b[0].tagName&&GENTICS.Aloha.Selection.replacingElements[a.tagName.toLowerCase()]&&GENTICS.Aloha.Selection.replacingElements[a.tagName.toLowerCase()].indexOf(b[0].tagName.toLowerCase())!=-1)return true}else GENTICS.Aloha.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return false};
GENTICS.Aloha.Selection.prototype.standardTextLevelSemanticsComparator=function(a,b){if(a.nodeType===1){if(a.tagName.toLowerCase()!=b[0].tagName.toLowerCase())return false;if(!this.standardAttributesComparator(a,b))return false;return true}else GENTICS.Aloha.Log.debug(this,"only element nodes (nodeType == 1) can be compared");return false};
GENTICS.Aloha.Selection.prototype.standardAttributesComparator=function(a,b){if(a.attributes&&a.attributes.length&&a.attributes.length>0)for(var c=0;c<a.attributes.length;c++){var d=a.attributes[c];if(d.nodeName.toLowerCase()=="class"&&d.nodeValue.length>0){d=d.nodeValue;var e=d.split(" ")}}if(b[0].attributes&&b[0].attributes.length&&b[0].attributes.length>0)for(c=0;c<b[0].attributes.length;c++){d=b[0].attributes[c];if(d.nodeName.toLowerCase()=="class"&&d.nodeValue.length>0){d=d.nodeValue;var g=d.split(" ")}}if(e&&
!g||g&&!e){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+a.tagName.toLowerCase()+"> failed because one element has classes and the other has not");return false}if(e&&g&&e.length!=e.length){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+a.tagName.toLowerCase()+"> failed because of a different amount of classes");return false}if(e&&g&&e.length==g.length&&e.length!=0)for(c=0;c<e.length;c++)if(!b.hasClass(e[c])){GENTICS.Aloha.Log.debug(this,"tag comparison for <"+a.tagName.toLowerCase()+"> failed because of different classes");
return false}return true};
GENTICS.Aloha.Selection.prototype.changeMarkup=function(a,b,c){if(this.replacingElements[b[0].tagName.toLowerCase()]){var d=a;a=new this.SelectionRange(a);var e=GENTICS.Aloha.activeEditable?GENTICS.Aloha.activeEditable.obj.get(0):jQuery("body");a.update(e);b.isReplacingElement=true}else if(a.isCollapsed()){GENTICS.Aloha.Log.debug(this,"early returning from applying markup because nothing is currently selected");return false}var g=GENTICS.Aloha.activeEditable?GENTICS.Aloha.activeEditable.obj[0]:jQuery("body"),
f=this.isRangeObjectWithinMarkup(a,false,b,c,g);e=this.isRangeObjectWithinMarkup(a,true,b,c,g);if(!b.isReplacingElement&&a.startOffset==0){var h;if(h=this.getTextNodeSibling(false,a.commonAncestorContainer.parentNode,a.startContainer))var j=this.isRangeObjectWithinMarkup({startContainer:h,startOffset:0},false,b,c,g)}if(!b.isReplacingElement&&a.endOffset==a.endContainer.length)if(h=this.getTextNodeSibling(true,a.commonAncestorContainer.parentNode,a.endContainer))var k=this.isRangeObjectWithinMarkup({startContainer:h,
startOffset:0},false,b,c,g);if(!b.isReplacingElement&&f&&!e){GENTICS.Aloha.Log.info(this,"markup 2 non-markup");this.prepareForRemoval(a.getSelectionTree(),b,c);jQuery(f).addClass("preparedForRemoval");this.insertCroppedMarkups(f,a,false,c)}else if(!b.isReplacingElement&&f&&e){GENTICS.Aloha.Log.info(this,"markup 2 markup");this.prepareForRemoval(a.getSelectionTree(),b,c);this.splitRelevantMarkupObject(f,e,a,c)}else if(!b.isReplacingElement&&(!f&&e||k||j)){GENTICS.Aloha.Log.info(this,"non-markup 2 markup OR with next2markup");
if(j&&k){g=new GENTICS.Aloha.Selection.SelectionRange(a);g.startContainer=jQuery(j[j.length-1]).textNodes()[0];g.startOffset=0;g.endContainer=jQuery(k[k.length-1]).textNodes().last()[0];g.endOffset=g.endContainer.length;g.update();this.applyMarkup(g.getSelectionTree(),a,b,c);GENTICS.Aloha.Log.info(this,"double extending previous markup(previous and after selection), actually wrapping it ...")}else if(j&&!k&&!e){this.extendExistingMarkupWithSelection(j,a,false,c);GENTICS.Aloha.Log.info(this,"extending previous markup")}else if(j&&
!k&&e){g=new GENTICS.Aloha.Selection.SelectionRange(a);g.startContainer=jQuery(j[j.length-1]).textNodes()[0];g.startOffset=0;g.endContainer=jQuery(e[e.length-1]).textNodes().last()[0];g.endOffset=g.endContainer.length;g.update();this.applyMarkup(g.getSelectionTree(),a,b,c);GENTICS.Aloha.Log.info(this,"double extending previous markup(previous and relevant at the end), actually wrapping it ...")}else if(!j&&k){this.extendExistingMarkupWithSelection(k,a,true,c);GENTICS.Aloha.Log.info(this,"extending following markup backwards")}else this.extendExistingMarkupWithSelection(e,
a,true,c)}else if(b.isReplacingElement||!f&&!e&&!j&&!k){GENTICS.Aloha.Log.info(this,"non-markup 2 non-markup");this.applyMarkup(a.getSelectionTree(),a,b,c,{setRangeObject2NewMarkup:true})}jQuery(".preparedForRemoval").zap();a.update();b.isReplacingElement?d.select():a.select()};
GENTICS.Aloha.Selection.prototype.areMarkupObjectsAsLongAsRangeObject=function(a,b,c){if(c.startOffset!==0)return false;for(var d=0;d<a.length;d++){var e=jQuery(a[d]);if(e.textNodes().first()[0]!==c.startContainer)return false}for(d=0;d<b.length;d++){e=jQuery(b[d]);if(e.textNodes().last()[0]!==c.endContainer||e.textNodes().last()[0].length!=c.endOffset)return false}return true};
GENTICS.Aloha.Selection.prototype.splitRelevantMarkupObject=function(a,b,c,d){jQuery(a).addClass("preparedForRemoval");jQuery(b).addClass("preparedForRemoval");if(this.areMarkupObjectsAsLongAsRangeObject(a,b,c))return true;var e=this.intersectRelevantMarkupObjects(a,b);if(e){this.insertCroppedMarkups([e],c,false,d);this.insertCroppedMarkups([e],c,true,d)}else{this.insertCroppedMarkups(a,c,false,d);this.insertCroppedMarkups(b,c,true,d)}return true};
GENTICS.Aloha.Selection.prototype.intersectRelevantMarkupObjects=function(a,b){var c=false;if(!a||!b)return c;for(var d=0;d<a.length;d++)for(var e=a[d],g=0;g<b.length;g++)if(e===b[g])c=e;return c};
GENTICS.Aloha.Selection.prototype.extendExistingMarkupWithSelection=function(a,b,c,d){if(!c)var e=true;if(c)var g=true;c=[];for(var f=0;f<a.length;f++){c[f]=new this.SelectionRange;el=a[f];if(g&&!e){c[f].startContainer=b.startContainer;c[f].startOffset=b.startOffset;textnodes=jQuery(el).textNodes(true);c[f].endContainer=textnodes[textnodes.length-1];c[f].endOffset=textnodes[textnodes.length-1].length;c[f].update();this.applyMarkup(c[f].getSelectionTree(),b,this.getClonedMarkup4Wrapping(el),d,{setRangeObject2NewMarkup:true})}if(!g&&
e){textnodes=jQuery(el).textNodes(true);c[f].startContainer=textnodes[0];c[f].startOffset=0;c[f].endContainer=b.endContainer;c[f].endOffset=b.endOffset;c[f].update();this.applyMarkup(c[f].getSelectionTree(),b,this.getClonedMarkup4Wrapping(el),d,{setRangeObject2NewMarkup:true})}}return true};GENTICS.Aloha.Selection.prototype.getClonedMarkup4Wrapping=function(a){a=jQuery(a).clone().removeClass("preparedForRemoval").empty();a.attr("class").length==0&&a.removeAttr("class");return a};
GENTICS.Aloha.Selection.prototype.insertCroppedMarkups=function(a,b,c,d){if(c)var e=true;else var g=true;c=[];for(var f=0;f<a.length;f++){c[f]=new this.SelectionRange;var h=a[f];if(g&&!e){var j=jQuery(h).textNodes(true);c[f].startContainer=j[0];c[f].startOffset=0;if(c[f].startContainer===b.startContainer&&c[f].startOffset===b.startOffset)continue;if(b.startOffset==0){c[f].endContainer=this.getTextNodeSibling(false,h,b.startContainer);c[f].endOffset=c[f].endContainer.length}else{c[f].endContainer=
b.startContainer;c[f].endOffset=b.startOffset}c[f].update();this.applyMarkup(c[f].getSelectionTree(),b,this.getClonedMarkup4Wrapping(h),d,{setRangeObject2NextSibling:true})}if(!g&&e){c[f].startContainer=b.endContainer;c[f].startOffset=b.endOffset;textnodes=jQuery(h).textNodes(true);c[f].endContainer=textnodes[textnodes.length-1];c[f].endOffset=textnodes[textnodes.length-1].length;c[f].update();this.applyMarkup(c[f].getSelectionTree(),b,this.getClonedMarkup4Wrapping(h),d,{setRangeObject2PreviousSibling:true})}}return true};
GENTICS.Aloha.Selection.prototype.changeMarkupOnSelection=function(a){this.changeMarkup(this.getRangeObject(),a,this.getStandardTagComparator(a));GENTICS.Utils.Dom.doCleanup({mergetext:true},this.rangeObject);this.rangeObject.update();this.rangeObject.select()};
GENTICS.Aloha.Selection.prototype.applyMarkup=function(a,b,c,d,e){e=e?e:{};this.prepareForRemoval(a,c,d);a=this.optimizeSelectionTree4Markup(a,c,d);breakpoint=true;for(var g=0;g<a.length;g++){var f=a[g];if(f.wrappable)this.wrapMarkupAroundSelectionTree(f.elements,b,c,d,e);else{GENTICS.Aloha.Log.debug(this,"dive further into non-wrappable object");this.applyMarkup(f.element.children,b,c,d,e)}}};
GENTICS.Aloha.Selection.prototype.getMarkupType=function(a){var b=jQuery(a)[0].nodeName.toLowerCase();a.outerHTML&&GENTICS.Aloha.Log.debug(this,"Node name detected: "+b+" for: "+a.outerHTML());if(b=="#text")return"textNode";if(this.replacingElements[b])return"sectionOrGroupingContent";if(this.tagHierarchy[b])return"textLevelSemantics";GENTICS.Aloha.Log.warn(this,"unknown markup passed to this.getMarkupType(...): "+a.outerHTML())};
GENTICS.Aloha.Selection.prototype.getStandardTagComparator=function(a){var b=this;switch(this.getMarkupType(a)){case "textNode":return function(){return false};case "sectionOrGroupingContent":return function(c,d){return b.standardSectionsAndGroupingContentComparator(c,d)};case "textLevelSemantics":default:return function(c,d){return b.standardTextLevelSemanticsComparator(c,d)}}};
GENTICS.Aloha.Selection.prototype.prepareForRemoval=function(a,b,c){typeof c!=="undefined"&&typeof c!=="function"&&GENTICS.Aloha.Log.error(this,"parameter tagComparator is not a function");if(typeof c==="undefined")c=this.getStandardTagComparator(b);for(var d=0;d<a.length;d++){var e=a[d];if(e.domobj&&(e.selection=="full"||e.selection=="partial"&&b.isReplacingElement))if(e.domobj.nodeType===1&&c(e.domobj,b)){GENTICS.Aloha.Log.debug(this,"Marking for removal: "+e.domobj.nodeName);jQuery(e.domobj).addClass("preparedForRemoval")}e.selection!=
"none"&&e.children.length>0&&this.prepareForRemoval(e.children,b,c)}};
GENTICS.Aloha.Selection.prototype.wrapMarkupAroundSelectionTree=function(a,b,c,d,e){var g=[],f=-1;GENTICS.Aloha.Log.debug(this,"The formatting <"+c[0].tagName+"> will be wrapped around the selection");for(var h="",j="",k=0;k<a.length;k++){var m=a[k];if(m.domobj&&!this.canTag1WrapTag2(m.domobj.parentNode.tagName.toLowerCase(),c[0].tagName.toLowerCase()))GENTICS.Aloha.Log.info(this,"Skipping the wrapping of <"+c[0].tagName.toLowerCase()+"> because this tag is not allowed inside <"+m.domobj.parentNode.tagName.toLowerCase()+
">");else if(!(m.domobj&&m.domobj.nodeType==3&&jQuery.trim(jQuery(m.domobj).outerHTML()).length==0)){if(m.domobj&&m.selection=="partial"&&!c.isReplacingElement)if(m.startOffset!==undefined&&m.endOffset===undefined){f++;h+=m.domobj.data.substr(0,m.startOffset);m.domobj.data=m.domobj.data.substr(m.startOffset,m.domobj.data.length-m.startOffset);g[f]=m.domobj}else if(m.endOffset!==undefined&&m.startOffset===undefined){f++;j+=m.domobj.data.substr(m.endOffset,m.domobj.data.length-m.endOffset);m.domobj.data=
m.domobj.data.substr(0,m.endOffset);g[f]=m.domobj}else if(m.endOffset!==undefined&&m.startOffset!==undefined){if(m.startOffset==m.endOffset){GENTICS.Aloha.Log.debug(this,"skipping empty selection");continue}f++;h+=m.domobj.data.substr(0,m.startOffset);var n=m.domobj.data.substr(m.startOffset,m.endOffset-m.startOffset);j+=m.domobj.data.substr(m.endOffset,m.domobj.data.length-m.endOffset);m.domobj.data=n;g[f]=m.domobj}else{GENTICS.Aloha.Log.debug(this,"diving into object");this.applyMarkup(m.children,
b,c,d,e)}if(m.domobj&&(m.selection=="full"||m.selection=="partial"&&c.isReplacingElement)){f++;g[f]=m.domobj}}}a=true;if(g.length>0){g=jQuery(g);jQuery.each(g,function(o,p){if(jQuery.browser.msie&&p.nodeType==3&&!p.nextSibling&&!p.previousSibling&&p.parentNode&&p.parentNode.nodeName.toLowerCase()=="li")p.data=jQuery.trim(p.data)});c=g.wrapAll(c).parent();c.before(h).after(j);a=true;if(e.setRangeObject2NewMarkup){h=g.textNodes();if(h.index(b.startContainer)!=-1)b.startOffset=0;if(h.index(b.endContainer)!=
-1)b.endOffset=b.endContainer.length;a=true}if(e.setRangeObject2NextSibling){h=true;j=c.textNodes(true).last()[0];if(g.index(b.startContainer)!=-1){b.startContainer=this.getTextNodeSibling(h,c.parent(),j);b.startOffset=0}if(g.index(b.endContainer)!=-1){b.endContainer=this.getTextNodeSibling(h,c.parent(),j);b.endOffset-=j.length}}if(e.setRangeObject2PreviousSibling){h=false;j=c.textNodes(true).first()[0];if(g.index(b.startContainer)!=-1){b.startContainer=this.getTextNodeSibling(h,c.parent(),j);b.startOffset=
0}if(g.index(b.endContainer)!=-1){b.endContainer=this.getTextNodeSibling(h,c.parent(),j);b.endOffset=b.endContainer.length}}}};GENTICS.Aloha.Selection.prototype.getTextNodeSibling=function(a,b,c){b=jQuery(b).textNodes(true);index=b.index(c);if(index==-1)return false;a=index+(!a?-1:1);return b[a]?b[a]:false};
GENTICS.Aloha.Selection.prototype.optimizeSelectionTree4Markup=function(a,b,c){var d=[],e=0,g=0,f=this;if(typeof c==="undefined")c=function(n,o){return f.standardTextLevelSemanticsComparator(o)};for(var h=0;h<a.length;h++)if(a[h].domobj&&a[h].selection!="none")if(b.isReplacingElement&&c(b[0],jQuery(a[h].domobj))){d[e]!==undefined&&e++;d[e]={};d[e].wrappable=true;d[e].elements=[];d[e].elements[g]=a[h];e++}else if(this.canMarkupBeApplied2ElementAsWhole([a[h]],b)){if(d[e]===undefined){d[e]={};d[e].wrappable=
true;d[e].elements=[]}if(b.isReplacingElement){for(var j=h,k=h-1;k>=0;k--)if(this.canMarkupBeApplied2ElementAsWhole([a[k]],b)&&this.isMarkupAllowedToStealSelectionTreeElement(a[k],b))j=k;else break;var m=h;for(k=h+1;k<a.length;k++)if(this.canMarkupBeApplied2ElementAsWhole([a[k]],b)&&this.isMarkupAllowedToStealSelectionTreeElement(a[k],b))m=k;else break;g=0;for(k=j;k<=m;k++){d[e].elements[g]=a[k];d[e].elements[g].selection="full";g++}g=0}else{d[e].elements[g]=a[h];g++}}else{d[e]!==undefined&&e++;d[e]=
{};d[e].wrappable=false;d[e].element=a[h];g=0;e++}return d};GENTICS.Aloha.Selection.prototype.isMarkupAllowedToStealSelectionTreeElement=function(a,b){if(!a.domobj)return false;var c=a.domobj.nodeName.toLowerCase();c=c=="#text"?"textNode":c;var d=b[0].nodeName.toLowerCase();if(!this.allowedToStealElements[d])return false;if(this.allowedToStealElements[d].indexOf(c)==-1)return false;return true};
GENTICS.Aloha.Selection.prototype.canMarkupBeApplied2ElementAsWhole=function(a,b){if(b.jquery)htmlTag=b[0].tagName;if(b.tagName)htmlTag=b.tagName;returnVal=true;for(var c=0;c<a.length;c++){var d=a[c];if(d.domobj&&(d.selection!="none"||b.isReplacingElement)){if(!this.canTag1WrapTag2(htmlTag,d.domobj.nodeName))return false;if(d.children.length>0&&!this.canMarkupBeApplied2ElementAsWhole(d.children,b))return false}}return returnVal};
GENTICS.Aloha.Selection.prototype.canTag1WrapTag2=function(a,b){a=a=="#text"?"textNode":a.toLowerCase();b=b=="#text"?"textNode":b.toLowerCase();if(!this.tagHierarchy[a])return true;if(!this.tagHierarchy[b])return true;return this.tagHierarchy[a].indexOf(b)!=-1?true:false};
GENTICS.Aloha.Selection.prototype.mayInsertTag=function(a){if(typeof this.rangeObject.unmodifiableMarkupAtStart=="object")for(var b=0;b<this.rangeObject.unmodifiableMarkupAtStart.length;++b){if(!this.canTag1WrapTag2(this.rangeObject.unmodifiableMarkupAtStart[b].nodeName,a))return false}else GENTICS.Aloha.Log.warn(this,"Unable to determine whether tag "+a+" may be inserted");return true};GENTICS.Aloha.Selection.prototype.toString=function(){return"GENTICS.Aloha.Selection"};
GENTICS.Aloha.Selection.prototype.SelectionRange=function(a){GENTICS.Utils.RangeObject.apply(this,arguments);this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];if(a){if(a.commonAncestorContainer)this.commonAncestorContainer=a.commonAncestorContainer;if(a.selectionTree)this.selectionTree=a.selectionTree;if(a.limitObject)this.limitObject=a.limitObject;if(a.markupEffectiveAtStart)this.markupEffectiveAtStart=a.markupEffectiveAtStart;if(a.unmodifiableMarkupAtStart)this.unmodifiableMarkupAtStart=
a.unmodifiableMarkupAtStart;if(a.splitObject)this.splitObject=a.splitObject}};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype=new GENTICS.Utils.RangeObject;GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.select=function(){GENTICS.Utils.RangeObject.prototype.select.apply(this,arguments);GENTICS.Aloha.Selection.updateSelection()};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.update=function(a){this.updatelimitObject();this.updateMarkupEffectiveAtStart();this.updateCommonAncestorContainer(a);this.selectionTree=undefined};GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.getSelectionTree=function(){if(!this.selectionTree)this.selectionTree=GENTICS.Aloha.Selection.getSelectionTree(this);return this.selectionTree};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.getSelectedSiblings=function(a){var b=this.getSelectionTree();return this.recursionGetSelectedSiblings(a,b)};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.recursionGetSelectedSiblings=function(a,b){for(var c=false,d=false,e=0;e<b.length;++e)if(b[e].domobj===a){d=true;c=[]}else if(!d&&b[e].children){c=this.recursionGetSelectedSiblings(a,b[e].children);if(c!==false)break}else if(d&&b[e].domobj&&b[e].selection!="collapsed"&&b[e].selection!="none")c.push(b[e].domobj);else if(d&&b[e].selection=="none")break;return c};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.updateMarkupEffectiveAtStart=function(){this.markupEffectiveAtStart=[];this.unmodifiableMarkupAtStart=[];for(var a=this.getStartContainerParents(),b=false,c=0;c<a.length;c++){var d=a[c];if(!b&&d!==this.limitObject){this.markupEffectiveAtStart[c]=d;if(!e&&GENTICS.Utils.Dom.isSplitObject(d)){var e=true;this.splitObject=d}}else{b=true;this.unmodifiableMarkupAtStart.push(d)}}if(!e)this.splitObject=false};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.updatelimitObject=function(){if(GENTICS.Aloha.editables&&GENTICS.Aloha.editables.length>0)for(var a=this.getStartContainerParents(),b=GENTICS.Aloha.editables,c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++)if(d===b[e].obj[0]){this.limitObject=d;return true}this.limitObject=jQuery("body");return true};
GENTICS.Aloha.Selection.prototype.SelectionRange.prototype.toString=function(a){if(!a)return"GENTICS.Aloha.Selection.SelectionRange";return"GENTICS.Aloha.Selection.SelectionRange {start ["+this.startContainer.nodeValue+"] offset "+this.startOffset+", end ["+this.endContainer.nodeValue+"] offset "+this.endOffset+"}"};GENTICS.Aloha.Selection=new GENTICS.Aloha.Selection;GENTICS.Aloha.Sidebar=function(){};GENTICS.Aloha.Sidebar.prototype.add=function(){};GENTICS.Aloha.Sidebar.prototype.render=function(){};
GENTICS.Aloha.Sidebar.prototype.openPanel=function(){};GENTICS.Aloha.Sidebar.prototype.closePanel=function(){};GENTICS.Aloha.Sidebar.prototype.togglePinPanel=function(){};GENTICS.Aloha.SidebarRight=new GENTICS.Aloha.Sidebar;GENTICS.Aloha.SidebarLeft=new GENTICS.Aloha.Sidebar;GENTICS.Aloha.Sidebar.Panel=function(){};GENTICS.Aloha.Sidebar.Panel.prototype.render=function(){};GENTICS.Aloha.RepositoryManager=function(){this.repositories=[]};GENTICS.Aloha.RepositoryManager.prototype.openCallbacks=[];
GENTICS.Aloha.RepositoryManager.prototype.init=function(){if(GENTICS.Aloha.settings.repositories==undefined)GENTICS.Aloha.settings.repositories={};for(var a=0;a<this.repositories.length;a++){var b=this.repositories[a];if(b.settings==undefined)b.settings={};GENTICS.Aloha.settings.repositories[b.repositoryId]&&jQuery.extend(b.settings,GENTICS.Aloha.settings.repositories[b.repositoryId]);b.init()}};
GENTICS.Aloha.RepositoryManager.prototype.register=function(a){if(a instanceof GENTICS.Aloha.Repository)this.getRepository(a.repositoryId)?GENTICS.Aloha.Log.warn(this,"A repository with name { "+a.repositoryId+" } already registerd. Ignoring this."):this.repositories.push(a);else GENTICS.Aloha.Log.error(this,"Trying to register a repository which is not an instance of GENTICS.Aloha.Repository.")};
GENTICS.Aloha.RepositoryManager.prototype.getRepository=function(a){for(var b=0;b<this.repositories.length;b++)if(this.repositories[b].repositoryId==a)return this.repositories[b];return null};
GENTICS.Aloha.RepositoryManager.prototype.query=function(a,b){var c=this,d=[],e=[];this.openCallbacks=[];var g=setTimeout(function(){c.openCallbacks=[];c.queryCallback(b,d,g)},5E3);if(a.repositoryId)e.push(this.getRepository(a.repositoryId));else e=this.repositories;for(var f=0;f<e.length;f++){this.openCallbacks.push(e[f].repositoryId);try{var h=e[f].query(a,function(m){var n=c.openCallbacks.indexOf(this.repositoryId);n!=-1&&c.openCallbacks.splice(n,1);if(!m.length==0&&!m[0].repositoryId)for(n=0;n<
m.length;n++)m[n].repositoryId=this.repositoryId;jQuery.merge(d,m);c.queryCallback(b,d,g)})}catch(j){h=true}if(h){var k=c.openCallbacks.indexOf(e[f].repositoryId);if(k!=-1){this.openCallbacks.splice(k,1);f==e.length-1&&this.queryCallback(b,d,g)}}}};GENTICS.Aloha.RepositoryManager.prototype.queryCallback=function(a,b,c){if(this.openCallbacks.length==0){clearTimeout(c);b.sort(function(d,e){return e.weight-d.weight});a.call(this,{results:b.length,items:b})}};
GENTICS.Aloha.RepositoryManager.prototype.getChildren=function(a,b){var c=this,d=[],e=[];this.openChildrenCallbacks=[];if(a.inFolderId=="aloha"&&this.repositories.length>0){e=[];for(var g=0;g<this.repositories.length;g++)e.push(new GENTICS.Aloha.Repository.Folder({id:this.repositories[g].repositoryId,name:this.repositories[g].repositoryName,repositoryId:this.repositories[g].repositoryId,type:"repository",hasMoreItems:true}));c.getChildrenCallback(b,e,null)}else{var f=setTimeout(function(){c.openChildrenCallbacks=
[];c.getChildrenCallback(b,d,f)},5E3);if(a.repositoryId)e.push(this.getRepository(a.repositoryId));else e=this.repositories;for(g=0;g<e.length;g++){this.openChildrenCallbacks.push(e[g].repositoryId);try{var h=e[g].getChildren(a,function(m){var n=c.openChildrenCallbacks.indexOf(this.repositoryId);n!=-1&&c.openChildrenCallbacks.splice(n,1);jQuery.merge(d,m);c.getChildrenCallback(b,d,f)})}catch(j){h=true}if(h){var k=c.openChildrenCallbacks.indexOf(e[g].repositoryId);if(k!=-1){this.openChildrenCallbacks.splice(k,
1);g==e.length-1&&this.getChildrenCallback(b,d,f)}}}}};GENTICS.Aloha.RepositoryManager.prototype.getChildrenCallback=function(a,b,c){if(this.openChildrenCallbacks.length==0){c&&clearTimeout(c);a.call(this,b)}};
GENTICS.Aloha.RepositoryManager.prototype.makeClean=function(a){var b=this,c={};a.find("[data-GENTICS-aloha-repository="+this.prefix+"]").each(function(){for(var d=0;d<b.repositories.length;d++)c.makeClean(a);GENTICS.Aloha.Log.debug(b,"Passing contents of HTML Element with id { "+this.attr("id")+" } for cleaning to repository { "+c.repositoryId+" }");c.makeClean(this)})};
GENTICS.Aloha.RepositoryManager.prototype.markObject=function(a,b){var c=this.getRepository(b.repositoryId);if(c){jQuery(a).attr({"data-GENTICS-aloha-repository":b.repositoryId,"data-GENTICS-aloha-object-id":b.id});c.markObject(a,b)}else GENTICS.Aloha.Log.error(this,"Trying to apply a repository { "+b.name+" } to an object, but item has no repositoryId.")};GENTICS.Aloha.RepositoryManager=new GENTICS.Aloha.RepositoryManager;GENTICS.Aloha.RepositoryManager.toString=function(){return"com.gentics.aloha.RepositoryManager"};
GENTICS.Aloha.Repository=function(a,b){this.repositoryId=a;this.settings={};this.repositoryName=b?b:a;GENTICS.Aloha.RepositoryManager.register(this)};GENTICS.Aloha.Repository.prototype.init=function(){};GENTICS.Aloha.Repository.prototype.query=function(){return true};GENTICS.Aloha.Repository.prototype.getChildren=function(){return true};GENTICS.Aloha.Repository.prototype.makeClean=function(){};GENTICS.Aloha.Repository.prototype.markObject=function(){};
GENTICS.Aloha.Repository.Document=function(a){this.type="document";if(!(!a.id||!a.name||!a.repositoryId)){GENTICS.Utils.applyProperties(this,a);this.baseType="document"}};GENTICS.Aloha.Repository.Folder=function(a){this.type="folder";if(!(!a.id||!a.name||!a.repositoryId)){GENTICS.Utils.applyProperties(this,a);this.baseType="folder"}};
